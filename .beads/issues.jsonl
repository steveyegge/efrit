{"id":"ef-1s7","title":"Verify efrit-chat has same tool access as efrit-do","description":"User requirement: efrit-chat should have access to all the same tools as efrit-do for quick one-off tasks.\n\nCurrent status:\n- efrit-do has 34 tools via efrit-do-schema.el\n- efrit-chat uses its own tool definitions (need to verify if same)\n- Need to confirm parity and identify any gaps\n\nKey questions:\n1. Does efrit-chat send the same tool schema to Claude?\n2. Are all tools like eval_sexp, shell_exec, todo_write available in chat?\n3. Any tools in efrit-do missing from efrit-chat?\n4. Any tools in efrit-chat missing from efrit-do (that shouldn't be)?","acceptance_criteria":"Document which tools are available in both systems, identify any tool gaps, and ensure feature parity for one-off tasks","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T18:08:40.938928-08:00","updated_at":"2025-12-02T18:14:55.124961-08:00","closed_at":"2025-12-02T18:14:55.124961-08:00"}
{"id":"ef-3pw","title":"Verify error handling and recovery in efrit-do async","description":"User requirement: Error handling must be solid for prime-time release.\n\nAreas to test:\n1. API errors (timeout, rate limit, auth failure) - should not crash, should show clear error\n2. Tool execution errors (bad elisp syntax, command not found) - should be caught and reported\n3. Circuit breaker trips - should show reason and allow recovery\n4. Session interruption (C-g) - should cleanup gracefully\n5. Recovery from errors - can Claude recover or does session need restart?\n\nCurrent implementation:\n- efrit-do--extract-error-info exists for error detection\n- efrit-do--build-error-context exists for context\n- Circuit breaker configured with limits\n- But integration testing needed\n\nTesting needed:\n1. Test bad elisp: (eval_sexp \"invalid lisp\")\n2. Test missing command: (shell_exec \"nonexistent_command\")\n3. Test timeout behavior\n4. Test session interruption\n5. Test recovery from transient errors","acceptance_criteria":"All error scenarios handled gracefully without crashing Emacs. Errors should be clearly displayed in progress buffer. Session should be recoverable or cleanly terminated.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-02T18:08:45.578341-08:00","updated_at":"2025-12-02T18:08:45.578341-08:00"}
{"id":"ef-8o0","title":"Potential timer leak in file watcher callbacks (efrit-remote-queue.el)","description":"In efrit-remote-queue.el line 526, each file system event creates a fire-and-forget timer with run-at-time. Under heavy file I/O or rapid file writes, this could accumulate timer objects that are never tracked or explicitly canceled.\n\nThe timer pattern:\n```\n(run-at-time 0.1 nil #'efrit-remote-queue--process-file file-path)\n```\n\nThis is a one-shot timer (interval=nil), but:\n1. Not tracked in any hash table or variable\n2. Called from a file watcher callback that fires on every file event\n3. Could accumulate hundreds of timers if files are written rapidly\n\nPotential solutions:\n1. Add a debounce mechanism to prevent multiple timers for the same file\n2. Use a timer tracking hash table like async-loop uses\n3. Add a maximum pending timers guard\n\nNote: Low risk since each timer is one-shot, but could affect performance under heavy load.","acceptance_criteria":"When file watcher is under heavy load (100+ files written quickly), verify that pending timers don't accumulate beyond a reasonable threshold (max ~20-30 pending).","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-02T18:08:31.280075-08:00","updated_at":"2025-12-02T18:08:31.280075-08:00"}
{"id":"ef-e3b","title":"Progress buffer appears automatically in efrit-do async - verify this is working","description":"User requirement: The efrit-do working buffer (progress buffer) should automatically appear when efrit-do starts asynchronous execution.\n\nCurrent code shows:\n- efrit-do-async-show-progress-buffer is set to t\n- efrit-do-async-loop is called with show-progress enabled\n- But this hasn't been manually tested\n\nNeed to:\n1. Verify progress buffer auto-displays when running efrit-do (interactive test)\n2. Verify it can be hidden with efrit-do-silently\n3. Verify it can be shown manually with efrit-do-show-progress\n4. Check that window management works correctly (doesn't break existing layout)","acceptance_criteria":"1. Run efrit-do with a test command, verify progress buffer appears automatically without manual action\n2. Run efrit-do-silently, verify no progress buffer appears\n3. Run efrit-do-show-progress, verify it displays the progress buffer\n4. Verify Emacs window layout is reasonable (doesn't delete user's existing windows)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-02T18:08:35.397107-08:00","updated_at":"2025-12-02T18:08:35.397107-08:00"}
{"id":"ef-uso","title":"Check for resource leaks in async execution loop","description":"User requirement: No resource leaks before release.\n\nAreas to audit:\n1. Buffer cleanup - are temporary buffers closed after sessions end?\n2. Timer cleanup - are all timers canceled when sessions end?\n3. Hash table cleanup - are session loops removed from tracking?\n4. HTTP connections - are URL requests properly closed?\n5. File handles - are any files left open after operations?\n\nCurrent code analysis shows:\n- efrit-do-async-loop.el properly cleans up via remhash (line 350)\n- Progress buffers may accumulate if many sessions run\n- One-shot timers in callbacks aren't tracked (efrit-do.el:1188, efrit-remote-queue.el:526)\n- Need to verify real cleanup under heavy load\n\nTesting needed:\n1. Run 10+ sequential efrit-do commands, check buffer count\n2. Monitor timer objects with (timer-list)\n3. Check for orphaned processes\n4. Stress test with concurrent commands and queueing\n5. Check memory growth over time","acceptance_criteria":"After running 10+ commands in quick succession, verify: no accumulation of buffers, no orphaned timers, no memory growth, no file descriptor leaks","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-02T18:08:50.308795-08:00","updated_at":"2025-12-02T18:08:50.308795-08:00"}
{"id":"ef-xmw","title":"CRITICAL: efrit-chat and efrit-do have very different tool sets - NOT feature parity","description":"CRITICAL ISSUE: efrit-chat only has 8 basic tools while efrit-do has 34 comprehensive tools.\n\nefrit-chat tools (hardcoded in efrit-chat-api.el lines 222-304):\n1. eval_sexp\n2. get_context\n3. resolve_path\n4. read_image\n5. create_buffer\n6. edit_buffer\n7. read_buffer\n8. buffer_info\n\nefrit-do tools (via efrit-do-schema.el):\n- All 8 chat tools PLUS\n- shell_exec\n- todo_write\n- session_complete\n- glob_files\n- request_user_input\n- confirm_action\n- checkpoint/restore\n- show_diff_preview\n- web_search\n- fetch_url\n- project_files\n- search_content\n- read_file\n- edit_file\n- create_file\n- file_info\n- vcs_status/diff/log/blame\n- elisp_docs\n- set_project_root\n- get_diagnostics\n- format_file\n- undo_edit\n- display_in_buffer\n- format_file_list\n- format_todo_list\n\nThis breaks the user requirement that efrit-chat should have access to all the same tools as efrit-do.\n\nBlocker for release until resolved.","acceptance_criteria":"efrit-chat must have access to all 34 tools available in efrit-do, OR the user must be clearly informed that efrit-chat is intentionally limited (not recommended for one-off tasks that need file operations)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-02T18:09:00.3812-08:00","updated_at":"2025-12-02T18:14:46.073883-08:00","closed_at":"2025-12-02T18:14:46.073883-08:00"}
{"id":"ef-zsd","title":"Add Beads MCP tool to Efrit","description":"Give Efrit access to beads CLI through MCP server. This allows Efrit to:\n- Check ready work (bd ready)\n- Create issues (bd create)\n- Update issue status (bd update)\n- Close issues (bd close)\n- List and query issues (bd list)\n- Inspect dependencies (bd show)\n\nShould be implemented as an MCP tool in the TypeScript/Node MCP server.","acceptance_criteria":"Efrit can execute beads commands through MCP and receive structured results. At minimum: bd ready, bd create, bd update, bd close, bd list","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-02T18:27:05.1739-08:00","updated_at":"2025-12-02T18:27:05.1739-08:00"}
