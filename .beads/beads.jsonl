{"id":"ef-05m","title":"Infrastructure: Tool execution timeout and async support","description":"Basic timeout infrastructure for new tools.\n\n## Scope (simplified from original)\nFocus on basic timeout support first. Async job execution deferred to separate issue.\n\n## Problem scenarios\n- search_content on huge repo: could take minutes\n- fetch_url on slow server: could hang\n- project_files with deep recursion: could be slow\n\n## Implementation\n\n### 1. Universal timeout wrapper\n```elisp\n(defun efrit-with-tool-timeout (timeout-secs body-fn)\n  \"Execute BODY-FN with TIMEOUT-SECS limit.\nReturns result or timeout error in standard format.\"\n  (with-timeout (timeout-secs \n                 '((success . nil) \n                   (error . ((type . \"timeout\")\n                            (message . \"Tool execution timed out\")))))\n    (funcall body-fn)))\n```\n\n### 2. Per-tool timeout configuration\n```elisp\n(defcustom efrit-tool-timeouts\n  '((search_content . 60)\n    (project_files . 30)\n    (fetch_url . 30)\n    (vcs_blame . 45)\n    (default . 30))\n  \"Timeout in seconds for each tool.\")\n```\n\n### 3. Progress reporting (optional enhancement)\n- Long-running tools can emit progress via efrit-progress.el\n- Not required for MVP, but nice to have\n\n## Deferred to separate issue\n- Async job execution (tool returns job ID, check later)\n- This is complex and not needed for Phase 1\n\n## Acceptance criteria\n- [ ] All new tools wrapped in timeout\n- [ ] Timeout produces standard error response\n- [ ] Timeouts are configurable\n- [ ] Tests verify timeout behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T16:40:37.193324-08:00","updated_at":"2025-11-25T17:12:31.910562-08:00","closed_at":"2025-11-25T17:12:31.910562-08:00"}
{"id":"ef-07c","title":"Implement search_content tool","description":"Grep-like content search across the codebase.\n\n## Input schema\n- pattern: search pattern (string)\n- is_regex: whether pattern is regex (default: false for literal search)\n- path: search scope (default: project root)\n- file_pattern: glob filter for files to search (e.g., '*.el', '*.py')\n- context_lines: lines before/after match (default: 2)\n- max_results: limit results (default: 50)\n- case_sensitive: (default: false)\n- offset: for pagination (default: 0)\n\n## Output (following standard format)\n```json\n{\n  \"success\": true,\n  \"result\": {\n    \"matches\": [\n      {\n        \"file\": \"/absolute/path/to/file.el\",\n        \"file_relative\": \"lisp/file.el\",\n        \"line\": 42,\n        \"column\": 15,\n        \"content\": \"the matching line content\",\n        \"context_before\": [\"line 40\", \"line 41\"],\n        \"context_after\": [\"line 43\", \"line 44\"]\n      }\n    ],\n    \"truncated\": true,\n    \"total_matches\": 150,\n    \"returned\": 50,\n    \"files_searched\": 234,\n    \"continuation_hint\": \"Use offset=50 to get more\"\n  }\n}\n```\n\n## Implementation priority\n1. ripgrep (rg) - fastest, best regex support\n2. grep - widely available fallback\n3. Elisp-native - last resort, slowest\n\n### ripgrep command\n```bash\nrg --json --max-count=\u003cmax_results\u003e \\\\\n   --context=\u003ccontext_lines\u003e \\\\\n   --glob='\u003cfile_pattern\u003e' \\\\\n   '\u003cpattern\u003e' '\u003cpath\u003e'\n```\n\n## Edge cases\n- Binary files: skip by default (rg does this)\n- Very long lines: truncate at 500 chars\n- Multi-line matches: include full match with \\\\n preserved\n- Empty results: return empty matches array, not error\n- Pattern with special chars: proper escaping based on is_regex\n\n## Performance\n- Timeout: 60 seconds (configurable)\n- Early termination when max_results reached\n- Stream results if possible (don't buffer entire output)\n\n## Depends on\n- ef-9hc: Security model (sandbox checks)\n- ef-05m: Timeout infrastructure\n- ef-ej7: Path/error standards","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-25T16:37:38.322258-08:00","updated_at":"2025-11-25T17:19:02.874658-08:00","closed_at":"2025-11-25T17:19:02.874658-08:00","dependencies":[{"issue_id":"ef-07c","depends_on_id":"ef-9hc","type":"blocks","created_at":"2025-11-25T16:40:45.257908-08:00","created_by":"daemon"},{"issue_id":"ef-07c","depends_on_id":"ef-05m","type":"blocks","created_at":"2025-11-25T16:40:48.428618-08:00","created_by":"daemon"},{"issue_id":"ef-07c","depends_on_id":"ef-ej7","type":"blocks","created_at":"2025-11-25T16:53:15.571555-08:00","created_by":"daemon"}]}
{"id":"ef-0ag","title":"Phase 1: Create *efrit-progress* buffer with auto-updating display","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:04:25.779776-08:00","updated_at":"2025-11-25T00:30:20.35105-08:00","closed_at":"2025-11-25T00:30:20.35105-08:00","dependencies":[{"issue_id":"ef-0ag","depends_on_id":"ef-0ji","type":"blocks","created_at":"2025-11-24T23:05:58.72832-08:00","created_by":"daemon"}]}
{"id":"ef-0ji","title":"Phase 1: Create progress.jsonl file channel for session events","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-24T23:04:23.915504-08:00","updated_at":"2025-11-24T23:16:22.422165-08:00","closed_at":"2025-11-24T23:16:22.422165-08:00","dependencies":[{"issue_id":"ef-0ji","depends_on_id":"ef-sha","type":"blocks","created_at":"2025-11-24T23:05:58.66201-08:00","created_by":"daemon"}]}
{"id":"ef-0xz","title":"Phase 2: Progress Consumption - External log tailing support","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:04:32.676279-08:00","updated_at":"2025-11-25T11:38:45.198939-08:00","closed_at":"2025-11-25T11:38:45.198939-08:00","dependencies":[{"issue_id":"ef-0xz","depends_on_id":"ef-0ji","type":"blocks","created_at":"2025-11-24T23:06:00.241765-08:00","created_by":"daemon"}]}
{"id":"ef-186","title":"Implement elisp_docs tool","description":"Structured Emacs Lisp documentation lookup.\n\n## Input schema\n- symbol: function, variable, or face name\n- type: 'function' | 'variable' | 'face' | 'auto' (default: auto)\n- include_source: whether to include source location (default: false)\n- related: whether to include related symbols via apropos (default: false)\n\n## Output\n- found: boolean\n- type: what kind of symbol it is\n- docstring: the documentation\n- signature: for functions, the argument list\n- source_file: where it's defined\n- source_line: line number in source\n- related_symbols: if requested, similar names from apropos\n\n## Implementation\nUse Emacs' built-in documentation system:\n- describe-function, describe-variable, describe-face\n- find-function-noselect for source location\n- apropos for related symbols\n\n## Why better than (describe-function ...)\n- Structured output Claude can reliably parse\n- Doesn't open help buffer (side effect free)\n- Can batch multiple lookups\n- Includes source location for deeper investigation\n\n## No security concerns\nPurely local, read-only access to Emacs' own documentation.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:39:53.107153-08:00","updated_at":"2025-11-25T17:47:40.632726-08:00","closed_at":"2025-11-25T17:47:40.632726-08:00"}
{"id":"ef-19t","title":"CRITICAL: efrit-do lacks agentic continuation loop","description":"efrit-do makes only ONE API call and returns, regardless of stop_reason.\n\n**Evidence from dogfood testing:**\n- Command: 'List .el files and summarize what each module does'\n- Claude called glob_files (success)\n- efrit-do returned immediately with just file list\n- No continuation to read files and summarize\n\n**Root cause:**\nefrit-do--process-api-response at line 2350:\n- Iterates over content items\n- Executes tool calls\n- Returns result without checking stop_reason\n- Never sends tool results back to Claude\n\n**GOOD NEWS: efrit-executor.el HAS the logic!**\nefrit-executor--handle-response (line 162):\n- Checks stop_reason at lines 186-191\n- If NOT 'end_turn', calls efrit-executor--continue-session (line 262)\n\n**The fix:**\nOption 1: Have efrit-remote-queue use efrit-execute instead of efrit-do\nOption 2: Refactor efrit-do to use efrit-executor's continuation logic\n\nThe remote queue currently does:\n  efrit-remote-queue--execute-command -\u003e efrit-do (no continuation)\n\nIt should do:\n  efrit-remote-queue--execute-command -\u003e efrit-execute (has continuation)\n\n**This is why efrit can't do multi-step agentic work.**","status":"open","priority":0,"issue_type":"bug","created_at":"2025-11-25T21:12:59.930835-08:00","updated_at":"2025-11-25T21:13:40.766597-08:00"}
{"id":"ef-1o2","title":"Tier 5: Agent-level challenge tests","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-24T22:51:25.461699-08:00","updated_at":"2025-11-25T01:13:43.517578-08:00","closed_at":"2025-11-25T01:13:43.517578-08:00","dependencies":[{"issue_id":"ef-1o2","depends_on_id":"ef-6sv","type":"blocks","created_at":"2025-11-24T22:51:42.691035-08:00","created_by":"daemon"}]}
{"id":"ef-1r6","title":"Testing: Tier 9 - Injection and conversation tests","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-24T23:05:11.95475-08:00","updated_at":"2025-11-25T11:59:04.304075-08:00","closed_at":"2025-11-25T11:59:04.304075-08:00","dependencies":[{"issue_id":"ef-1r6","depends_on_id":"ef-gth","type":"blocks","created_at":"2025-11-24T23:06:13.671082-08:00","created_by":"daemon"},{"issue_id":"ef-1r6","depends_on_id":"ef-bxc","type":"blocks","created_at":"2025-11-24T23:06:13.73463-08:00","created_by":"daemon"}]}
{"id":"ef-261","title":"Epic: Project-Wide Awareness - Phase 4 (External Knowledge)","description":"Connect Efrit to external knowledge sources.\n\n## Goal\nLet Claude look things up when stuck, access documentation, and stay current.\n\n## Tools in this phase\n- elisp_docs: Structured Emacs Lisp documentation lookup (local, safe)\n- web_search: Search for solutions, documentation, examples\n- fetch_url: Retrieve specific documentation pages\n\n## Success criteria\n- Claude can look up Elisp function signatures\n- Claude can search for 'how to X in Emacs' when stuck\n- Claude can fetch and read documentation pages\n\n## Security considerations\n- elisp_docs is local-only, always safe\n- web_search requires explicit user opt-in\n- fetch_url should have domain allowlist or per-request confirmation\n\n## Architecture principle\nThese are read-only knowledge gathering tools. No modification of external systems. Claude decides when to look things up.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-25T16:39:30.913399-08:00","updated_at":"2025-11-25T18:59:16.053316-08:00","closed_at":"2025-11-25T18:59:16.053316-08:00","dependencies":[{"issue_id":"ef-261","depends_on_id":"ef-186","type":"blocks","created_at":"2025-11-25T16:40:02.690724-08:00","created_by":"daemon"},{"issue_id":"ef-261","depends_on_id":"ef-gyd","type":"blocks","created_at":"2025-11-25T16:40:02.754419-08:00","created_by":"daemon"},{"issue_id":"ef-261","depends_on_id":"ef-odk","type":"blocks","created_at":"2025-11-25T16:40:02.816535-08:00","created_by":"daemon"}]}
{"id":"ef-27c","title":"Testing: Tier 8 - Progress streaming verification tests","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:05:09.903859-08:00","updated_at":"2025-11-25T09:45:02.733272-08:00","closed_at":"2025-11-25T09:45:02.733272-08:00","dependencies":[{"issue_id":"ef-27c","depends_on_id":"ef-gth","type":"blocks","created_at":"2025-11-24T23:06:13.549349-08:00","created_by":"daemon"},{"issue_id":"ef-27c","depends_on_id":"ef-0ji","type":"blocks","created_at":"2025-11-24T23:06:13.613016-08:00","created_by":"daemon"}]}
{"id":"ef-2un","title":"Implement vcs_diff tool","description":"See what has changed in the repository.\n\n## Input schema\n- path: file or directory (default: all)\n- staged: show staged changes only (default: false)\n- commit: diff against specific commit (optional)\n- context_lines: lines of context (default: 3)\n\n## Output\n- diff: unified diff format string\n- summary: files_changed, insertions, deletions\n- files: list of changed files with per-file stats\n\n## Implementation\nUse git diff with appropriate flags:\n- git diff (unstaged)\n- git diff --staged (staged)\n- git diff \u003ccommit\u003e (against commit)\n\n## Use cases\n- Review changes before committing\n- Understand what was modified in a session\n- Compare against specific commits","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:38:26.017744-08:00","updated_at":"2025-11-25T17:22:48.381303-08:00","closed_at":"2025-11-25T17:22:48.381303-08:00"}
{"id":"ef-3go","title":"Update efrit--handle-api-response to send tool results back","description":"In efrit--handle-api-response (efrit-chat.el:646), when tool-results exist: 1) Add assistant message to history, 2) Build user message with tool_result content blocks, 3) Add to history, 4) Call efrit--send-api-request to continue conversation. Only display final response to user after Claude processes tool results.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-24T00:37:37.521052-08:00","updated_at":"2025-11-24T00:58:16.941194-08:00","closed_at":"2025-11-24T00:58:16.941194-08:00","dependencies":[{"issue_id":"ef-3go","depends_on_id":"ef-5af","type":"blocks","created_at":"2025-11-24T00:40:35.857492-08:00","created_by":"daemon"}]}
{"id":"ef-3ta","title":"Implement efrit-budget.el core module","description":"Create new module lisp/core/efrit-budget.el with:\n\n## Prerequisites (do first!)\nUpdate efrit-session.el work log format to include tool name:\n- Change `efrit-session-add-work` to accept tool-name parameter\n- Update work log entry format from `(result elisp todo-snapshot)` to include tool\n- Update `efrit-session--compress-smart` to use tool-name for compression\n\n## Core Data Structure\n```elisp\n(cl-defstruct efrit-budget\n  (total-limit 100000)\n  (system-used 0)\n  (history-used 0)\n  (tool-results-used 0)\n  (warnings '()))\n```\n\n## Functions to Implement\n\n1. `efrit-budget-estimate-tokens` - Character-based token estimation (~3.5 chars/token)\n2. `efrit-budget-create` - Initialize budget for new session\n3. `efrit-budget-allocate-tool` - Get allocation for tool call\n4. `efrit-budget-record-usage` - Track token usage by category\n5. `efrit-budget-remaining` - Calculate available budget\n6. `efrit-budget-format-warning` - Generate low-budget warnings\n\n## Customization Variables\n- efrit-budget-total-target (100000)\n- efrit-budget-per-tool-default (8000)\n- efrit-budget-history-max (12000)\n- efrit-budget-warning-threshold (20000)\n\n## Design Doc\nSee: docs/design/context-budget-management.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:17:48.3422-08:00","updated_at":"2025-11-25T20:29:12.049726-08:00","closed_at":"2025-11-25T20:29:12.049726-08:00"}
{"id":"ef-4in","title":"Integrate budget tracking with efrit-session.el","description":"Integrate efrit-budget.el with session management.\n\n## Changes to efrit-session.el\n\n### Session Struct Extension\nAdd budget field to efrit-session struct:\n- budget slot holding efrit-budget struct\n\n### Lifecycle Integration\n1. efrit-session-create: Initialize budget struct\n2. efrit-session-add-work: Update budget after tool result, use tool-specific compression\n3. efrit-session-compress-log: Use budget-aware compression\n\n### Work Log Updates\n- Call efrit-budget-compress-for-history for each entry based on tool name\n- Track history-used tokens in budget struct\n- Apply LRU eviction when over budget (oldest entries removed first)\n\n### Budget Reporting\nBefore each continuation API call:\n1. Calculate current budget state\n2. Add budget warnings to system prompt when remaining \u003c threshold\n3. Include budget summary in session context\n\n## New Functions\n- efrit-session-get-budget: Get budget struct for active session\n- efrit-session-budget-status: Return budget summary string for Claude\n- efrit-session-evict-oldest-work: Remove oldest work log entry (for LRU)\n\n## Note\nDynamic tool schema updates (budget hints in descriptions) are handled by ef-8nm.\n\n## Design Doc\nSee: docs/design/context-budget-management.md","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-25T19:18:25.36662-08:00","updated_at":"2025-11-25T19:28:14.479927-08:00","dependencies":[{"issue_id":"ef-4in","depends_on_id":"ef-3ta","type":"blocks","created_at":"2025-11-25T19:26:24.855452-08:00","created_by":"daemon"},{"issue_id":"ef-4in","depends_on_id":"ef-85i","type":"blocks","created_at":"2025-11-25T19:26:24.920282-08:00","created_by":"daemon"}]}
{"id":"ef-4wr","title":"Testing: Integration tests for new tools","description":"Comprehensive testing strategy for new tool suite.\n\n## Testing tiers (extending existing framework)\n\n### Tier 1: Unit tests for each tool\n- project_files: mock file system, verify output format\n- search_content: test regex, glob filters, max_results\n- read_file: line ranges, encoding, large file handling\n- vcs_*: mock git output, parse correctly\n\n### Tier 2: Integration tests (real file system)\n- Create temp project with known structure\n- Test project_files returns expected tree\n- Test search_content finds known patterns\n- Test read_file handles various encodings\n\n### Tier 3: Claude integration tests\n- Give Claude a task requiring new tools\n- Verify Claude uses tools appropriately\n- Test error recovery when tools fail\n- Test tool chaining (search → read → modify)\n\n### Tier 4: Security tests\n- Verify project root sandboxing works\n- Test sensitive file blocking\n- Test network access controls\n- Test timeout enforcement\n\n### Tier 5: Performance tests\n- Large repo (10k+ files) handling\n- Search performance benchmarks\n- Memory usage under load\n\n## Test infrastructure needs\n- Temp directory fixtures\n- Git repo fixtures (for vcs_* tests)\n- Mock HTTP server (for web tests)\n\n## CI integration\n- Tests should run in GitHub Actions\n- Consider caching test fixtures","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-25T16:41:01.813785-08:00","updated_at":"2025-11-25T16:41:01.813785-08:00"}
{"id":"ef-5af","title":"Modify efrit--extract-content-and-tools to return tool results","description":"Change efrit--extract-content-and-tools return value from (cons message-text should-delegate) to (list message-text tool-results should-delegate) where tool-results is a list of tool_result blocks built with efrit--build-tool-result. Collect ALL tool results, not just errors. Location: efrit-chat.el:493-552","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-24T00:37:29.871923-08:00","updated_at":"2025-11-24T00:55:48.462133-08:00","closed_at":"2025-11-24T00:55:48.462133-08:00","dependencies":[{"issue_id":"ef-5af","depends_on_id":"ef-al6","type":"blocks","created_at":"2025-11-24T00:40:35.722329-08:00","created_by":"daemon"},{"issue_id":"ef-5af","depends_on_id":"ef-fub","type":"blocks","created_at":"2025-11-24T00:40:35.789524-08:00","created_by":"daemon"}]}
{"id":"ef-5nx","title":"Implement project_files tool","description":"Give Claude visibility into project file structure.\n\n## Input schema\n- path: directory to scan (default: project root via project.el)\n- pattern: glob pattern filter (optional, e.g., '*.el')\n- max_depth: recursion depth (default: 5, 0 = current dir only)\n- include_hidden: include dotfiles/dotdirs (default: false)\n- max_files: limit total files returned (default: 500)\n- offset: for pagination (default: 0)\n\n## Output (following standard format)\n```json\n{\n  \"success\": true,\n  \"result\": {\n    \"root\": \"/absolute/path/to/project\",\n    \"project_type\": \"git\",\n    \"files\": [\n      {\n        \"path\": \"/absolute/path/to/file.el\",\n        \"path_relative\": \"lisp/file.el\",\n        \"size\": 12345,\n        \"mtime\": \"2025-01-15T10:30:00Z\",\n        \"is_directory\": false,\n        \"is_symlink\": false\n      }\n    ],\n    \"directories\": 45,\n    \"total_files\": 234,\n    \"truncated\": false,\n    \"gitignore_respected\": true\n  }\n}\n```\n\n## Implementation notes\n- Use project.el for root detection (project-current, project-root)\n- Use directory-files-recursively for traversal\n- Respect .gitignore if git project (use git ls-files when possible)\n- Format timestamps as ISO 8601\n\n## Output format options\nTwo modes (controlled by 'format' parameter):\n1. 'flat' (default): Simple list of files as shown above\n2. 'tree': Nested structure mirroring directory hierarchy\n\n## Edge cases\n- Symlinks: include but mark is_symlink=true, don't follow\n- Permission denied: skip file, include in warnings\n- Very deep nesting: respect max_depth strictly\n- No project detected: use current directory as root, warn\n\n## Project type detection\nCheck for (in order):\n- .git → 'git'\n- package.json → 'npm'  \n- Cargo.toml → 'cargo'\n- setup.py/pyproject.toml → 'python'\n- Makefile → 'make'\n- None → 'unknown'\n\n## Performance\n- Timeout: 30 seconds\n- Use git ls-files when possible (much faster for git repos)\n- Consider caching project structure (invalidate on file changes)\n\n## Depends on\n- ef-9hc: Security model (sandbox)\n- ef-ej7: Path/error standards","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-25T16:37:36.910523-08:00","updated_at":"2025-11-25T17:15:01.281514-08:00","closed_at":"2025-11-25T17:15:01.281514-08:00","dependencies":[{"issue_id":"ef-5nx","depends_on_id":"ef-9hc","type":"blocks","created_at":"2025-11-25T16:40:45.196638-08:00","created_by":"daemon"},{"issue_id":"ef-5nx","depends_on_id":"ef-ej7","type":"blocks","created_at":"2025-11-25T16:53:15.535035-08:00","created_by":"daemon"}]}
{"id":"ef-5yl","title":"Continuation uses wrong message format - tool results not in messages","description":"efrit-executor--continue-session sends the wrong message format for continuation.\n\n**Current behavior:**\nMessages only contains original command:\n  ('messages' . [('role' . 'user') ('content' . original_command)])\n\nWork log is put in SYSTEM PROMPT.\n\n**Correct format per Claude API:**\n  ('messages' . [\n    ('role' . 'user') ('content' . 'original command')\n    ('role' . 'assistant') ('content' . [('type' . 'tool_use') ...])\n    ('role' . 'user') ('content' . [('type' . 'tool_result') ...])\n  ])\n\n**Evidence from dogfood:**\n- Claude called glob_files 4 times with identical input\n- Circuit breaker detected infinite loop\n- Claude kept saying 'I'll list the .el files' - not seeing previous results\n\n**Why this matters:**\nClaude's API requires tool_use/tool_result to be in the messages array. Putting work history in system prompt doesn't work - Claude doesn't 'remember' previous tool calls.\n\n**Fix:**\nefrit-executor needs to:\n1. Store Claude's full response (including tool_use content blocks)\n2. Store tool_result for each tool call\n3. Build proper messages array for continuation\n\nThis likely requires changes to efrit-session to track the full conversation history.","status":"open","priority":0,"issue_type":"bug","created_at":"2025-11-25T21:14:57.301224-08:00","updated_at":"2025-11-25T21:14:57.301224-08:00"}
{"id":"ef-690","title":"Implement show_diff_preview tool","description":"Show user proposed changes before applying them.\n\n## Input schema\n- changes: list of proposed changes, each with:\n  - file: path\n  - old_content: current content (or null for new file)\n  - new_content: proposed content (or null for deletion)\n- description: what these changes accomplish\n- apply_mode: 'all_or_nothing' | 'selective' (user picks which to apply)\n\n## Output\n- approved: boolean (user approved applying changes)\n- selected_changes: if selective mode, which changes to apply\n- user_edits: if user modified the proposed content\n\n## UI presentation\n- Display in dedicated *efrit-diff-preview* buffer\n- Use diff-mode highlighting\n- Allow user to edit proposed changes before applying\n- Clear approve/reject buttons\n\n## Implementation\n- Generate unified diff for display\n- Handle new files (all +), deleted files (all -), modified files\n- Support user editing the 'new' side before approval","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:39:09.860562-08:00","updated_at":"2025-11-25T18:54:54.097744-08:00","closed_at":"2025-11-25T18:54:54.097744-08:00","dependencies":[{"issue_id":"ef-690","depends_on_id":"ef-aa5","type":"blocks","created_at":"2025-11-25T16:39:21.725543-08:00","created_by":"daemon"},{"issue_id":"ef-690","depends_on_id":"ef-2un","type":"blocks","created_at":"2025-11-25T16:53:16.904929-08:00","created_by":"daemon"}]}
{"id":"ef-6rw","title":"Identical tool call detection not catching glob_files loops","description":"The circuit breaker's identical-call detection (efrit-do-max-identical-tool-calls=3) is not stopping glob_files loops effectively.\n\n**Evidence from multiple dogfood tests:**\n\nTest 1: 'List all the .el files in /Users/stevey/src/efrit/lisp/core/ and count how many there are'\n- 13 glob_files calls with same input hash before circuit breaker stopped it\n\nTest 2: 'Create a new buffer called *dogfood-test* with a list of all .el files in /Users/stevey/src/efrit/lisp/'  \n- 11 consecutive glob_files calls\n- Circuit breaker never tripped\n- Session had to be manually cancelled\n\n**Root cause analysis:**\n1. The identical call counter appears to be reset between API continuations\n2. Each new continuation starts fresh, so 'identical' count never reaches 3 within a single API call\n3. The circuit breaker only checks within a single response, not across the session\n\n**Real impact:**\n- Simple file listing tasks burn 10-13x more tokens than needed\n- glob_files tool appears broken - Claude keeps retrying it\n- May also indicate glob_files is returning an error that makes Claude retry\n\n**Fix needed:**\n1. Persist identical-call counters across continuations\n2. OR: Track tool call patterns at the session level, not response level\n3. Investigate why glob_files results make Claude want to retry","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T21:11:59.871469-08:00","updated_at":"2025-11-24T22:00:08.645157-08:00","closed_at":"2025-11-24T22:00:08.645157-08:00"}
{"id":"ef-6sv","title":"Manual Testing Plan: Efrit-do-async Agent Capability","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-24T22:51:10.734528-08:00","updated_at":"2025-11-25T01:19:59.737976-08:00","closed_at":"2025-11-25T01:19:59.737976-08:00"}
{"id":"ef-6wy","title":"Phase 1: Progress Emission - Create efrit-progress.el module","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-24T23:04:20.631651-08:00","updated_at":"2025-11-24T23:16:04.61386-08:00","closed_at":"2025-11-24T23:16:04.61386-08:00"}
{"id":"ef-79c","title":"Implement vcs_blame tool","description":"Line-by-line code attribution.\n\n## Input schema\n- path: file to blame (required)\n- start_line: optional range start\n- end_line: optional range end\n\n## Output\n- lines: list of:\n  - line_number: int\n  - commit: short hash\n  - author: name\n  - date: when this line was last changed\n  - content: the actual line content\n\n## Implementation\nParse git blame output:\ngit blame -p \u003cfile\u003e (porcelain format for easy parsing)\n\n## Use cases\n- Understand who wrote specific code\n- Find when a line was introduced\n- Identify code that hasn't been touched in years\n\n## Performance note\nCan be slow on large files. Consider caching or limiting line range.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-25T16:38:29.078908-08:00","updated_at":"2025-11-25T17:49:50.687754-08:00","closed_at":"2025-11-25T17:49:50.687754-08:00"}
{"id":"ef-7w9","title":"Streamlined mode uses wrong tool_result format","description":"efrit-streamlined--continue-with-results sends tool results as plain text content instead of proper tool_result blocks. API expects: {type: 'tool_result', tool_use_id: 'xxx', content: '...'} but we send: {role: 'user', content: 'Tool result for xxx: ...'}. Location: efrit-chat.el:854-882","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-24T00:33:40.609606-08:00","updated_at":"2025-11-24T00:38:14.025971-08:00","closed_at":"2025-11-24T00:38:14.025971-08:00","dependencies":[{"issue_id":"ef-7w9","depends_on_id":"ef-rk0","type":"blocks","created_at":"2025-11-24T00:34:09.395909-08:00","created_by":"daemon"}]}
{"id":"ef-7za","title":"Phase 3: Injection Channel - Create inject queue directory and protocol","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:04:42.662925-08:00","updated_at":"2025-11-25T11:32:40.408063-08:00","closed_at":"2025-11-25T11:32:40.408063-08:00","dependencies":[{"issue_id":"ef-7za","depends_on_id":"ef-tii","type":"blocks","created_at":"2025-11-24T23:06:02.121175-08:00","created_by":"daemon"}]}
{"id":"ef-840","title":"Tier 1: Single-tool smoke tests","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-24T22:51:19.197168-08:00","updated_at":"2025-11-24T23:32:25.528889-08:00","closed_at":"2025-11-24T23:32:25.528889-08:00","dependencies":[{"issue_id":"ef-840","depends_on_id":"ef-6sv","type":"blocks","created_at":"2025-11-24T22:51:42.449369-08:00","created_by":"daemon"}]}
{"id":"ef-85i","title":"Add tool-specific result compression","description":"Add compression functions for each Phase 1-4 tool to support work log history.\n\n## Tool Compression Functions\n\n### project_files\n- Compress file list: count, type breakdown, key paths\n- Output: \"500 files. Types: .el (234), .md (45). Key: lisp/, test/\"\n\n### search_content  \n- Compress search: match count, files, sample matches\n- Output: \"50 matches in 12 files: file1.el (5), file2.el (3)...\"\n\n### read_file\n- Compress file read: path, size, key sections\n- Output: \"Read file.el (1234 lines, 45KB)\"\n\n### vcs_* tools\n- vcs_diff: \"5 files, +234/-89 lines. Modified: file1.el...\"\n- vcs_log: \"15 commits. Recent: abc1234 fix bug, def5678 add feature...\"\n- vcs_status: \"3 modified, 2 untracked. M: file1.el, file2.el\"\n\n## Implementation Location\nAdd to efrit-budget.el or each tool file\n\n## Target\n~500 chars max per compressed result\n\n## Design Doc\nSee: docs/design/context-budget-management.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:18:11.700748-08:00","updated_at":"2025-11-25T21:02:56.41663-08:00","closed_at":"2025-11-25T21:02:56.41663-08:00","dependencies":[{"issue_id":"ef-85i","depends_on_id":"ef-3ta","type":"blocks","created_at":"2025-11-25T19:26:24.795349-08:00","created_by":"daemon"}]}
{"id":"ef-8nm","title":"Add dynamic budget hints to tool schemas","description":"Update tool schemas dynamically based on remaining budget.\n\n## Changes to efrit-do.el\n\n### Schema Generation\nUpdate efrit-do--get-tools-schema to:\n1. Accept budget parameter\n2. Modify tool descriptions with budget hints\n3. Adjust default values based on remaining budget\n\n### Example Updates\n\nproject_files:\n- Original: \"List project files\"  \n- With budget: \"List project files. Budget allows ~200 files.\"\n\nsearch_content:\n- Original: \"Search content\"\n- With budget: \"Search content. Budget allows ~30 matches with context.\"\n\n### Budget Warnings\nWhen budget \u003c warning threshold, prepend to system prompt:\n\"[Budget Alert: ~20k tokens remaining. Consider completing or summarizing.]\"\n\n## Implementation\n- efrit-do--inject-budget-hints(schema, budget)\n- efrit-do--budget-warning-prompt(budget)\n\n## Priority\nLower priority (P3) - nice to have but not essential for MVP\n\n## Design Doc\nSee: docs/design/context-budget-management.md","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-25T19:18:40.350722-08:00","updated_at":"2025-11-25T19:18:51.932081-08:00","dependencies":[{"issue_id":"ef-8nm","depends_on_id":"ef-4in","type":"blocks","created_at":"2025-11-25T19:26:24.987502-08:00","created_by":"daemon"}]}
{"id":"ef-8p7","title":"Improve efrit-tools-system-prompt to teach Claude to read before writing","description":"System prompt SUCCESSFULLY enhanced with read-verify-act pattern.\n\nCHANGES MADE (lisp/core/efrit-tools.el:619-780):\n\n✅ Added CRITICAL RULE #1 at top (lines 622-627)\n   - Visual interrupt with ⚠️ and borders\n   - Explicit: 'ALWAYS read buffer contents BEFORE manipulating'\n   - Repeated 3 times (primacy, middle, recency)\n\n✅ Added Read-Verify-Act Pattern section (636-646)\n   - 3-step workflow clearly defined\n   - READ → VERIFY → ACT\n   - Concrete examples for each step\n\n✅ Added Anti-Patterns section (648-665)\n   - Shows failures BEFORE solutions (contrast effect)\n   - Exact user scenario: blind goto-char (point-max)\n   - Why it fails + what error results\n   - 3 wrong examples, 1 right example\n\n✅ Added Reading Buffer Contents section (667-683)\n   - (buffer-string) for current buffer\n   - (with-current-buffer NAME (buffer-string)) for specific\n   - (get-buffer NAME) to check existence\n   - save-excursion for non-destructive reads\n\n✅ Added Finding Positions Safely section (685-703)\n   - Find last sexp with backward-sexp\n   - Find function definitions with re-search-forward\n   - All use save-excursion (non-destructive)\n\n✅ Added Complete Worked Example (705-728)\n   - User request: 'eval last form in *scratch*'\n   - Shows WRONG approach that will fail\n   - Shows RIGHT approach step-by-step\n   - Includes actual buffer contents analysis\n\n✅ Added closing reminder (774-778)\n   - Repeats READ BEFORE WRITE rule\n   - 'STOP and read first. No exceptions.'\n\nMETRICS:\n- Old prompt: ~2,200 chars, 80 lines\n- New prompt: 6,944 chars, 183 lines\n- Key sections: 7 major additions\n- Examples: 3 anti-patterns, 1 complete workflow, 8 reading techniques\n\nCOMPILATION: ✓ Clean (no errors/warnings)\nPROMPT GENERATION: ✓ All sections present","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-24T10:42:27.633831-08:00","updated_at":"2025-11-24T11:24:02.887572-08:00","closed_at":"2025-11-24T11:24:02.887572-08:00"}
{"id":"ef-8q3","title":"Integrate Phase 1/2 tools into efrit-do tool schema","description":"The Phase 1/2 tools (project_files, search_content, read_file, file_info, vcs_status, vcs_diff, vcs_log, vcs_blame, elisp_docs) were implemented in lisp/tools/ but never integrated into efrit-do--tools-schema. The tools exist and work, but Claude cannot use them.\n\nRequired:\n1. Add tool schemas to efrit-do--tools-schema \n2. Add handlers in efrit-do--handle-tool-use\n3. Add to appropriate tool categories in efrit-do--get-tools-for-state\n4. Load tool modules in efrit-do.el (require statements)\n5. Add to 'tools/' load-path in efrit-autonomous-startup.el\n\nThe budget module (efrit-budget.el) already has compressors ready for these tools.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-25T21:08:37.443254-08:00","updated_at":"2025-11-25T21:08:46.921476-08:00"}
{"id":"ef-8sp","title":"Progress files not created during remote queue operations","description":"The progress.jsonl files should be created in ~/.emacs.d/.efrit/sessions/\u003csession-id\u003e/ but no files are being created during remote queue operations. Either progress emission is not wired up for efrit-do, or sessions aren't being created properly.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-25T14:25:41.860199-08:00","updated_at":"2025-11-25T14:41:13.027329-08:00","closed_at":"2025-11-25T14:41:13.027329-08:00"}
{"id":"ef-8to","title":"Fix streamlined mode tool_result format","description":"In efrit-streamlined--continue-with-results (efrit-chat.el:854), change from sending plain text to using proper tool_result blocks. Use efrit--build-tool-result helper. Change content from 'Tool result for xxx: ...' to proper [{type: 'tool_result', tool_use_id: 'xxx', content: '...'}] format.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-24T00:37:43.600482-08:00","updated_at":"2025-11-24T01:01:01.170361-08:00","closed_at":"2025-11-24T01:01:01.170361-08:00","dependencies":[{"issue_id":"ef-8to","depends_on_id":"ef-al6","type":"blocks","created_at":"2025-11-24T00:40:35.922634-08:00","created_by":"daemon"}]}
{"id":"ef-8y3","title":"Testing: Tier 7 - Remote queue protocol tests","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:05:08.195576-08:00","updated_at":"2025-11-25T09:43:45.821457-08:00","closed_at":"2025-11-25T09:43:45.821457-08:00","dependencies":[{"issue_id":"ef-8y3","depends_on_id":"ef-gth","type":"blocks","created_at":"2025-11-24T23:06:13.484211-08:00","created_by":"daemon"}]}
{"id":"ef-981","title":"efrit-executor doesn't check stop_reason to detect session completion","description":"The efrit-executor module handles response processing but doesn't check the `stop_reason` field from Claude's API response to determine when to complete the session.\n\n**Current behavior:**\n- Session continues as long as Claude uses tools (stop_reason: tool_use)\n- Session ONLY completes when `session_complete` tool returns [SESSION-COMPLETE: ...]\n- Even if Claude returns stop_reason: end_turn, the session continues\n\n**Expected behavior:**\n- When stop_reason is 'end_turn', the session should complete\n- When stop_reason is 'tool_use', continue processing tools\n- The session_complete tool should be optional, not required\n\n**Impact:**\nRelated to ef-syq (Claude doesn't call session_complete). If we checked stop_reason properly, we might not need Claude to explicitly call session_complete - the session would end naturally when Claude stops using tools.\n\n**Location:** lisp/core/efrit-executor.el:170 (efrit-executor--handle-response)\n\n**Fix:** \nAdd check for (gethash \"stop_reason\" response) = \"end_turn\" to trigger session completion even without explicit session_complete call.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T21:14:37.522703-08:00","updated_at":"2025-11-24T21:54:56.449402-08:00","closed_at":"2025-11-24T21:54:56.449402-08:00","dependencies":[{"issue_id":"ef-981","depends_on_id":"ef-syq","type":"blocks","created_at":"2025-11-24T21:14:49.088011-08:00","created_by":"daemon"}]}
{"id":"ef-9bn","title":"efrit-do-async sessions don't complete properly - never fires session_completed hook","description":"When running efrit-do-async, the session completes work but never fires any completion hook. Root cause: efrit-session-completed-hook doesn't exist - it was never defined. The test shows sessions completing (buffer created, code executed, status changed to complete) but no hook mechanism exists for async callers to know when done. Fix needed: 1) Define efrit-session-completed-hook variable, 2) Call run-hook-with-args in efrit-session-complete function, 3) Document the hook signature (session, result). This breaks all async completion callbacks.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T12:39:41.171516-08:00","updated_at":"2025-11-24T15:53:41.950111-08:00","closed_at":"2025-11-24T15:53:41.950111-08:00"}
{"id":"ef-9hc","title":"Infrastructure: Security model for new tools","description":"Define and implement security model for expanded tool set.\n\n## Risk assessment by tool\n\n### Low risk (project-scoped, read-only)\n- project_files, search_content, read_file, file_info\n- vcs_status, vcs_diff, vcs_log, vcs_blame\n- elisp_docs\nMitigation: Restrict to project root by default\n\n### Medium risk (user interaction, local side effects)\n- confirm_action, show_diff_preview, checkpoint\nMitigation: These ARE the mitigation for other tools\n\n### High risk (network access, external data)\n- web_search, fetch_url\nMitigation: Opt-in, allowlists, per-request confirmation\n\n## Implementation\n\n### 1. Project root sandboxing\n- New variable: efrit-project-sandbox (default: t)\n- When enabled, file tools restricted to project root\n- User can disable for trusted operations\n\n### 2. Sensitive file protection\n- Blocklist: .env, *credentials*, *.pem, .authinfo*\n- Require explicit confirmation to read these\n- Never include in search results by default\n\n### 3. Network access controls\n- efrit-enable-web-access (default: nil)\n- efrit-allowed-domains (default: documentation sites)\n- efrit-confirm-each-fetch (default: t)\n\n### 4. Audit logging\n- Log all tool invocations with inputs\n- Log all confirmations (approved/rejected)\n- Useful for debugging and trust building","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T16:40:35.695526-08:00","updated_at":"2025-11-25T17:12:20.236088-08:00","closed_at":"2025-11-25T17:12:20.236088-08:00"}
{"id":"ef-9w1","title":"efrit-do (sync) handles simple tasks well, efrit-do-async fails on them","description":"**Observation from dogfooding:**\n\nefrit-do (synchronous) successfully handles simple tasks like 'What time is it?'\n- Single API call\n- Correct tool use (eval_sexp with current-time-string)  \n- Proper result returned\n\nefrit-do-async fails on the same types of tasks because:\n- It activates SESSION MODE in the system prompt\n- SESSION MODE tells Claude to use tools and continue\n- Claude doesn't know when to call session_complete\n- Results in 30+ API calls until circuit breaker trips\n\n**Architectural question:**\nShould efrit-do-async use a different strategy for simple tasks? Options:\n1. Detect simple tasks upfront and use single-shot mode (no SESSION MODE)\n2. Fix SESSION MODE to properly complete on simple tasks  \n3. Make stop_reason='end_turn' auto-complete the session (see ef-981)\n\n**Related issues:**\n- ef-jsj: loops on simple questions\n- ef-syq: doesn't call session_complete\n- ef-981: doesn't check stop_reason","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T21:20:29.040403-08:00","updated_at":"2025-11-24T21:57:52.727304-08:00","closed_at":"2025-11-24T21:57:52.727304-08:00"}
{"id":"ef-aa5","title":"Implement read_file tool","description":"Read arbitrary files, not just open buffers.\n\n## Input schema\n- path: file to read (absolute or project-relative)\n- start_line: optional line to start from (1-indexed)\n- end_line: optional line to end at (inclusive)\n- encoding: optional encoding override (default: auto-detect)\n- max_size: max bytes to read (default: 100000, ~100KB)\n\n## Output (following standard format)\n```json\n{\n  \"success\": true,\n  \"result\": {\n    \"path\": \"/absolute/path/to/file.el\",\n    \"path_relative\": \"lisp/file.el\",\n    \"content\": \"file contents here...\",\n    \"encoding\": \"utf-8\",\n    \"size\": 12345,\n    \"mtime\": \"2025-01-15T10:30:00Z\",\n    \"total_lines\": 500,\n    \"lines_returned\": \"1-500\",\n    \"truncated\": false\n  },\n  \"warnings\": []\n}\n```\n\n## Large file handling\n- Files \u003e max_size: truncate and set truncated=true\n- Include message: \"File truncated at 100KB. Use start_line/end_line for specific sections.\"\n- If start_line/end_line specified, read only that range (more efficient)\n\n## Binary file handling\n- Detect binary via: null bytes in first 8KB, or known binary extensions\n- For binary files, return:\n  ```json\n  {\n    \"success\": true,\n    \"result\": {\n      \"path\": \"...\",\n      \"is_binary\": true,\n      \"size\": 50000,\n      \"mime_type\": \"image/png\",\n      \"content\": null\n    },\n    \"warnings\": [\"Binary file detected, content not returned\"]\n  }\n  ```\n- Do NOT base64 encode (too large for context)\n\n## Encoding handling\n1. Check for encoding cookie (e.g., -*- coding: utf-8 -*-)\n2. Check BOM\n3. Try utf-8\n4. Fall back to system locale\n5. If all fail, try latin-1 (accepts anything)\n\n## Security\n- Sandbox check via efrit-resolve-path\n- Sensitive file check against blocklist\n- If sensitive file requested: require confirmation or error\n\n## Difference from eval_sexp + find-file\n- read_file is read-only (safer)\n- Doesn't create buffers (lighter weight)\n- Structured output with metadata\n- Binary detection\n- Line range support\n\n## Depends on\n- ef-9hc: Security model\n- ef-ej7: Path/error standards","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-25T16:37:39.834592-08:00","updated_at":"2025-11-25T17:16:04.675857-08:00","closed_at":"2025-11-25T17:16:04.675857-08:00","dependencies":[{"issue_id":"ef-aa5","depends_on_id":"ef-9hc","type":"blocks","created_at":"2025-11-25T16:40:45.324355-08:00","created_by":"daemon"},{"issue_id":"ef-aa5","depends_on_id":"ef-ej7","type":"blocks","created_at":"2025-11-25T16:53:15.601459-08:00","created_by":"daemon"}]}
{"id":"ef-af8","title":"Missing tool_use_id capture in classic chat mode","description":"efrit--extract-content-and-tools doesn't capture the tool_use_id from API response. We extract tool-name and input but not the id field. This makes it impossible to send proper tool_result messages back to Claude. Location: efrit-chat.el:514-515. Note: Streamlined mode DOES capture it (line 910)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-24T00:33:47.622243-08:00","updated_at":"2025-11-24T00:38:14.038429-08:00","closed_at":"2025-11-24T00:38:14.038429-08:00","dependencies":[{"issue_id":"ef-af8","depends_on_id":"ef-rk0","type":"blocks","created_at":"2025-11-24T00:34:09.47262-08:00","created_by":"daemon"}]}
{"id":"ef-ajc","title":"Classic chat mode doesn't send tool results back to Claude","description":"When Claude uses tools (eval_sexp), efrit-chat executes them but never sends tool_result messages back per the Anthropic API protocol. This causes Claude to not know if tools succeeded, leading to confused multi-turn behavior. Location: efrit--extract-content-and-tools in efrit-chat.el:493-552","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-24T00:33:25.451302-08:00","updated_at":"2025-11-24T00:38:14.014263-08:00","closed_at":"2025-11-24T00:38:14.014263-08:00","dependencies":[{"issue_id":"ef-ajc","depends_on_id":"ef-rk0","type":"blocks","created_at":"2025-11-24T00:34:09.331915-08:00","created_by":"daemon"}]}
{"id":"ef-al6","title":"Add efrit--build-tool-result helper function","description":"Create helper function to build proper tool_result content blocks: (defun efrit--build-tool-result (tool-id result) ...) that returns: '((type . \"tool_result\") (tool_use_id . ,tool-id) (content . ,(format \"%s\" result))). This encapsulates the correct API format per Anthropic docs.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-24T00:37:22.157082-08:00","updated_at":"2025-11-24T00:53:54.648457-08:00","closed_at":"2025-11-24T00:53:54.648457-08:00"}
{"id":"ef-bcv","title":"Claude uses buffer_create instead of eval_sexp for code tasks inappropriately","description":"When asked 'create buffer and define fibonacci function', Claude uses buffer_create tool with pre-written content instead of using eval_sexp to interactively build the code. The buffer_create approach prevents: 1) Incremental code building, 2) Real-time evaluation, 3) Error feedback loops. System prompt should emphasize eval_sexp for code generation tasks. The buffer_create tool should be reserved for displaying results/reports, not creating code.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-24T12:39:43.106927-08:00","updated_at":"2025-11-24T20:19:23.955083-08:00","closed_at":"2025-11-24T20:19:23.955083-08:00"}
{"id":"ef-bdt","title":"'Failed to restore context' warnings on every command","description":"Every command execution logs 'WARN: Failed to restore context: #\u003c...' to *efrit-log*. This suggests context restoration is failing silently. Need to investigate what context is being restored and why it fails.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-25T14:25:41.808571-08:00","updated_at":"2025-11-25T14:39:30.408322-08:00","closed_at":"2025-11-25T14:39:30.408322-08:00"}
{"id":"ef-beu","title":"Write test for fibonacci scenario","description":"Create emacs --batch test that: 1) Sends 'Write fibonacci in *scratch*', 2) Verifies code appears in *scratch*, 3) Sends 'Now evaluate fib(10)', 4) Verifies result is 55. This is the test case that exposed the bug. Should pass after protocol fix.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-24T00:37:50.699131-08:00","updated_at":"2025-11-24T20:15:48.760594-08:00","closed_at":"2025-11-24T20:15:48.760594-08:00","dependencies":[{"issue_id":"ef-beu","depends_on_id":"ef-3go","type":"blocks","created_at":"2025-11-24T00:40:00.571869-08:00","created_by":"daemon"},{"issue_id":"ef-beu","depends_on_id":"ef-8to","type":"blocks","created_at":"2025-11-24T00:40:00.633413-08:00","created_by":"daemon"}]}
{"id":"ef-bxc","title":"Phase 3: Check for injections in executor continuation loop","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:04:44.432838-08:00","updated_at":"2025-11-25T11:34:08.759086-08:00","closed_at":"2025-11-25T11:34:08.759086-08:00","dependencies":[{"issue_id":"ef-bxc","depends_on_id":"ef-7za","type":"blocks","created_at":"2025-11-24T23:06:02.185094-08:00","created_by":"daemon"}]}
{"id":"ef-bzl","title":"Fix multibyte text in HTTP request error in efrit-chat","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-24T00:25:58.574505-08:00","updated_at":"2025-11-24T00:26:11.585964-08:00","closed_at":"2025-11-24T00:26:11.585964-08:00"}
{"id":"ef-cls","title":"Remote queue shows 'Command executed successfully' instead of actual result","description":"Remote queue handler returns 'Command executed successfully' for most commands instead of the actual result (e.g., file counts, git status output). This is related to ef-krh - the root cause is that efrit-do doesn't return values. The queue handler at line 384 in efrit-remote-queue.el tries to capture stdout but that doesn't work.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-25T14:25:41.907633-08:00","updated_at":"2025-11-25T14:38:10.479881-08:00","closed_at":"2025-11-25T14:38:10.479881-08:00"}
{"id":"ef-cmv","title":"Epic: Project-Wide Awareness - Phase 2 (Version Control)","description":"Git integration tools for understanding repository state.\n\n## Goal\nLet Claude understand what has changed, who changed it, and repository history.\n\n## Tools in this phase\n- vcs_status: Current repo state (branch, modified files, etc.)\n- vcs_diff: See what has changed\n- vcs_log: Commit history\n- vcs_blame: Line-by-line attribution\n\n## Success criteria\n- Claude can answer 'what files have I modified?'\n- Claude can review changes before committing\n- Claude can understand code history for debugging\n\n## Dependencies\n- Should follow Phase 1 (proves the pattern)\n- vcs_diff benefits from read_file for context\n\n## Architecture principle\nPure context gathering. Claude interprets git output, tool doesn't make judgments about 'good' vs 'bad' changes.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-25T16:38:04.736476-08:00","updated_at":"2025-11-25T17:24:07.056063-08:00","closed_at":"2025-11-25T17:24:07.056063-08:00","dependencies":[{"issue_id":"ef-cmv","depends_on_id":"ef-m28","type":"blocks","created_at":"2025-11-25T16:38:35.31237-08:00","created_by":"daemon"},{"issue_id":"ef-cmv","depends_on_id":"ef-2un","type":"blocks","created_at":"2025-11-25T16:38:35.376321-08:00","created_by":"daemon"},{"issue_id":"ef-cmv","depends_on_id":"ef-rqu","type":"blocks","created_at":"2025-11-25T16:38:35.438721-08:00","created_by":"daemon"},{"issue_id":"ef-cmv","depends_on_id":"ef-79c","type":"blocks","created_at":"2025-11-25T16:38:35.506965-08:00","created_by":"daemon"},{"issue_id":"ef-cmv","depends_on_id":"ef-n0f","type":"blocks","created_at":"2025-11-25T16:38:36.955721-08:00","created_by":"daemon"}]}
{"id":"ef-d1q","title":"Tier 4: Emacs-specific capability tests","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T22:51:23.982346-08:00","updated_at":"2025-11-24T23:39:33.852182-08:00","closed_at":"2025-11-24T23:39:33.852182-08:00","dependencies":[{"issue_id":"ef-d1q","depends_on_id":"ef-6sv","type":"blocks","created_at":"2025-11-24T22:51:42.629796-08:00","created_by":"daemon"}]}
{"id":"ef-dyj","title":"Testing: Convert Tier 1-6 tests to automated specs","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-24T23:05:06.739949-08:00","updated_at":"2025-11-25T00:25:01.301053-08:00","closed_at":"2025-11-25T00:25:01.301053-08:00","dependencies":[{"issue_id":"ef-dyj","depends_on_id":"ef-gth","type":"blocks","created_at":"2025-11-24T23:06:13.422016-08:00","created_by":"daemon"}]}
{"id":"ef-e6t","title":"Implement restore_checkpoint tool","description":"Restore from a checkpoint created by checkpoint tool.\n\n## Input schema\n- checkpoint_id: which checkpoint to restore (required)\n- files: optional list of specific files to restore (default: all)\n- preview: show what would be restored without doing it (default: false)\n\n## Output\n- restored: boolean\n- files_restored: list of files that were restored\n- method_used: 'git_stash_pop' | 'file_restore' | 'both'\n- warnings: any issues encountered\n\n## Implementation\nBased on checkpoint method:\n- git_stash: git stash pop or git stash apply\n- file_backup: copy files back from backup location\n- Verify files haven't been further modified (warn if so)\n\n## Edge cases\n- Checkpoint no longer exists (expired or manually deleted)\n- Files modified since checkpoint (conflict resolution)\n- Partial restore if some files fail\n\n## Depends on\n- checkpoint tool (ef-hks) must exist first","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-25T16:52:40.111115-08:00","updated_at":"2025-11-25T18:52:39.994171-08:00","closed_at":"2025-11-25T18:52:39.994171-08:00","dependencies":[{"issue_id":"ef-e6t","depends_on_id":"ef-hks","type":"blocks","created_at":"2025-11-25T16:52:46.510838-08:00","created_by":"daemon"}]}
{"id":"ef-ehx","title":"Epic: Conversational Efrit - Progress Visibility and User Interaction","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-24T23:04:12.784087-08:00","updated_at":"2025-11-25T11:46:01.733033-08:00","closed_at":"2025-11-25T11:46:01.733033-08:00","dependencies":[{"issue_id":"ef-ehx","depends_on_id":"ef-6wy","type":"blocks","created_at":"2025-11-24T23:05:35.565708-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-sha","type":"blocks","created_at":"2025-11-24T23:05:35.627867-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-0ji","type":"blocks","created_at":"2025-11-24T23:05:35.68955-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-0ag","type":"blocks","created_at":"2025-11-24T23:05:35.748856-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-0xz","type":"blocks","created_at":"2025-11-24T23:05:43.281611-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-tii","type":"blocks","created_at":"2025-11-24T23:05:43.336589-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-oat","type":"blocks","created_at":"2025-11-24T23:05:43.40049-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-7za","type":"blocks","created_at":"2025-11-24T23:05:45.52483-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-bxc","type":"blocks","created_at":"2025-11-24T23:05:45.587404-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-slc","type":"blocks","created_at":"2025-11-24T23:05:45.654309-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-oks","type":"blocks","created_at":"2025-11-24T23:05:47.717718-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-lgk","type":"blocks","created_at":"2025-11-24T23:05:47.780001-08:00","created_by":"daemon"},{"issue_id":"ef-ehx","depends_on_id":"ef-emw","type":"blocks","created_at":"2025-11-24T23:05:47.846864-08:00","created_by":"daemon"}]}
{"id":"ef-ej7","title":"Infrastructure: Standardize tool path handling and error responses","description":"Define consistent conventions for all new tools.\n\n## Problem\nCurrent tool designs have inconsistent approaches to:\n- Path input (absolute? relative? project-relative?)\n- Error responses (format, structure)\n- Large result handling (truncation, pagination)\n\n## Path Handling Standard\n\n### Input paths\n- All tools accept both absolute and project-relative paths\n- Project-relative paths resolved via efrit-resolve-path helper\n- Empty/nil path defaults to project root (detected via project.el)\n- Paths outside project root: error if sandboxed, warn if not\n\n### Helper function\n```elisp\n(defun efrit-resolve-path (path \u0026optional allow-outside)\n  \"Resolve PATH relative to project root.\nIf PATH is absolute, use as-is (with sandbox check).\nIf PATH is relative, resolve against project root.\nIf ALLOW-OUTSIDE is nil and path escapes sandbox, signal error.\"\n  ...)\n```\n\n### Path in output\n- Always return absolute paths in output\n- Include project-relative version for display\n\n## Error Response Standard\n\nAll tools should return consistent error format:\n```json\n{\n  \"success\": false,\n  \"error\": {\n    \"type\": \"not_found\" | \"permission_denied\" | \"timeout\" | \"invalid_input\" | ...,\n    \"message\": \"Human-readable error message\",\n    \"details\": { ... optional structured details ... }\n  }\n}\n```\n\nSuccess responses:\n```json\n{\n  \"success\": true,\n  \"result\": { ... tool-specific result ... },\n  \"warnings\": [ ... optional warnings ... ]\n}\n```\n\n## Large Result Standard\n\nFor tools that can return large results (project_files, search_content, etc.):\n\n### Truncation\n- Default max_results or max_size per tool\n- Always include truncation indicator:\n  ```json\n  {\n    \"truncated\": true,\n    \"total_available\": 1500,\n    \"returned\": 50,\n    \"continuation_hint\": \"Use offset=50 to get more\"\n  }\n  ```\n\n### Pagination pattern\n- All list-returning tools support: offset, limit\n- Default limit is tool-specific but reasonable (50-100)\n\n## Implementation\n- Create efrit-tool-utils.el with helpers\n- Update all tool handlers to use standard patterns\n- Document in tool schema descriptions\n\n## Must complete before\nAny Phase 1 tool implementation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T16:53:06.865945-08:00","updated_at":"2025-11-25T17:10:57.231936-08:00","closed_at":"2025-11-25T17:10:57.231936-08:00"}
{"id":"ef-emw","title":"Phase 4: Implement session resume after user response","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-24T23:04:55.822821-08:00","updated_at":"2025-11-25T11:45:45.048014-08:00","closed_at":"2025-11-25T11:45:45.048014-08:00","dependencies":[{"issue_id":"ef-emw","depends_on_id":"ef-lgk","type":"blocks","created_at":"2025-11-24T23:06:04.350658-08:00","created_by":"daemon"}]}
{"id":"ef-fub","title":"Capture tool_use_id in efrit--extract-content-and-tools","description":"In efrit--extract-content-and-tools (efrit-chat.el:514), add: (tool-id (gethash 'id' item)) to capture the tool_use_id from API response. This is needed to build proper tool_result messages. Return tool-id along with result. Pattern to copy: streamlined mode line 910 already does this correctly.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-24T00:37:15.641125-08:00","updated_at":"2025-11-24T00:46:19.765994-08:00","closed_at":"2025-11-24T00:46:19.765994-08:00"}
{"id":"ef-gth","title":"Testing: Create automated test runner (efrit-test-runner.el)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-24T23:05:05.401794-08:00","updated_at":"2025-11-25T00:04:33.974905-08:00","closed_at":"2025-11-25T00:04:33.974905-08:00"}
{"id":"ef-gyd","title":"Implement web_search tool","description":"Search the web for documentation, solutions, examples.\n\n## Input schema\n- query: search terms (required)\n- site: site restriction (e.g., 'emacs.stackexchange.com')\n- max_results: limit (default: 5)\n- type: 'general' | 'docs' | 'code' (default: 'general')\n\n## Output\n```json\n{\n  \"success\": true,\n  \"result\": {\n    \"query_used\": \"emacs parse json elisp\",\n    \"results\": [\n      {\n        \"title\": \"How to parse JSON in Emacs Lisp\",\n        \"url\": \"https://emacs.stackexchange.com/q/12345\",\n        \"snippet\": \"You can use json-read-from-string...\",\n        \"source\": \"emacs.stackexchange.com\"\n      }\n    ],\n    \"total_estimated\": 1500,\n    \"returned\": 5\n  }\n}\n```\n\n## User consent flow\n\n### First use in session\nWhen web_search is called and efrit-enable-web-access is nil:\n1. Tool automatically invokes confirm_action:\n   - severity: 'info'\n   - action: 'Enable web search for this session?'\n   - details: ['Query: \u003cthe query\u003e', 'This will send the query to \u003csearch provider\u003e']\n2. If user confirms: set session-local web-access flag, proceed\n3. If user rejects: return error with type='permission_denied'\n\n### Subsequent uses\nIf session already has web-access enabled, proceed without asking.\n\n### Permanent enable\nUser can set efrit-enable-web-access to t to skip consent.\n\n## Implementation options (choose one)\n1. **DuckDuckGo HTML** - No API key, scrape HTML results\n   - Pro: Free, no account needed\n   - Con: Rate limited, fragile parsing\n2. **Brave Search API** - Requires free API key\n   - Pro: Good quality, fast, generous free tier\n   - Con: Requires signup\n3. **SerpAPI** - Requires API key ($)\n   - Pro: Reliable, multiple engines\n   - Con: Costs money\n\nRecommendation: Start with DuckDuckGo, add Brave as configurable upgrade.\n\n## Rate limiting\n- Max 10 searches per session by default\n- Configurable via efrit-web-search-max-per-session\n- After limit: error with helpful message\n\n## Caching\n- Cache results for 1 hour by default\n- Same query within cache period returns cached results\n- Configurable via efrit-web-search-cache-seconds\n\n## Privacy note\nInclude in tool description for Claude:\n\"Note: Search queries are sent to external service. Do not include sensitive user data in queries.\"\n\n## Depends on\n- ef-9hc: Security model (web access controls)\n- ef-wv9: confirm_action (for consent flow)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:39:54.505561-08:00","updated_at":"2025-11-25T18:57:07.400419-08:00","closed_at":"2025-11-25T18:57:07.400419-08:00","dependencies":[{"issue_id":"ef-gyd","depends_on_id":"ef-9hc","type":"blocks","created_at":"2025-11-25T16:40:46.83109-08:00","created_by":"daemon"},{"issue_id":"ef-gyd","depends_on_id":"ef-wv9","type":"blocks","created_at":"2025-11-25T16:55:04.849253-08:00","created_by":"daemon"}]}
{"id":"ef-gyx","title":"Fix multibyte text in HTTP request error in efrit-chat","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-24T00:25:52.910592-08:00","updated_at":"2025-11-24T13:55:46.859091-08:00","closed_at":"2025-11-24T13:55:46.859091-08:00"}
{"id":"ef-hks","title":"Implement checkpoint tool","description":"Create restore points before risky operations.\n\n## Input schema\n- description: what operation we're about to do\n- files: list of files to snapshot (or 'all' for project)\n- include_staged: whether to include git staged state\n\n## Output\n- checkpoint_id: unique identifier for this checkpoint\n- files_saved: count of files checkpointed\n- method: 'git_stash' | 'file_backup' | 'both'\n\n## Restore mechanism\nSeparate restore_checkpoint tool:\n- checkpoint_id: which checkpoint to restore\n- selective: optional list of specific files to restore\n\n## Implementation options\n1. Use git stash for git repos (cleanest)\n2. File-based backup for non-git or mixed scenarios\n3. Both for maximum safety\n\n## Use cases\n- Before refactoring: checkpoint, then Claude can be aggressive\n- Before bulk operations: safety net\n- User can say 'undo everything since last checkpoint'\n\n## Cleanup\n- Auto-expire old checkpoints (configurable, default 24h)\n- List checkpoints with bd checkpoint list equivalent","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-25T16:39:11.359306-08:00","updated_at":"2025-11-25T17:56:02.798481-08:00","closed_at":"2025-11-25T17:56:02.798481-08:00","dependencies":[{"issue_id":"ef-hks","depends_on_id":"ef-m28","type":"blocks","created_at":"2025-11-25T16:53:18.204104-08:00","created_by":"daemon"}]}
{"id":"ef-hoh","title":"Circuit breaker too restrictive for eval_sexp - blocks legitimate multi-step work","description":"The circuit breaker has efrit-do-max-same-tool-calls=3 by default which blocks legitimate multi-step work. For complex tasks like 'write sorting algorithms with timing comparisons', Claude needs to call eval_sexp 10+ times consecutively. Current behavior trips after 3 consecutive same-tool calls. Fix options: 1) Increase default to 15-20, 2) Track 'same input' not just 'same tool', 3) Reset counter when tool succeeds without error, 4) Separate limits for eval_sexp vs other tools.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T12:39:39.398128-08:00","updated_at":"2025-11-24T15:36:26.839978-08:00","closed_at":"2025-11-24T15:36:26.839978-08:00"}
{"id":"ef-i2w","title":"Tier 3: Multi-step workflow tests (TODO-based)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T22:51:22.614911-08:00","updated_at":"2025-11-24T23:37:44.478375-08:00","closed_at":"2025-11-24T23:37:44.478375-08:00","dependencies":[{"issue_id":"ef-i2w","depends_on_id":"ef-6sv","type":"blocks","created_at":"2025-11-24T22:51:42.56962-08:00","created_by":"daemon"}]}
{"id":"ef-ioq","title":"glob_files hangs Emacs when called with nil input","description":"When efrit-do--handle-glob-files is called with nil input, it defaults to scanning ~/\nrecursively for all files. This can hang Emacs for a very long time (or indefinitely) on\nsystems with large home directories.\n\n**How it happens:**\n1. If Claude calls glob_files with malformed input (nil or missing fields)\n2. The function defaults: pattern='~/' extension='*' recursive=t  \n3. This triggers (directory-files-recursively \"~\" \".*\")\n4. On typical systems with large home dirs, this effectively hangs Emacs\n\n**Evidence:**\nDuring dogfooding, the Emacs daemon became unresponsive after glob_files tests.\nemacsclient commands timed out until the daemon was killed.\n\n**Fix needed:**\n1. Validate inputs more strictly - don't accept nil\n2. Limit recursive search depth\n3. Use a safer default path like current directory, not ~\n4. Add a timeout to file operations","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-24T21:19:51.45472-08:00","updated_at":"2025-11-24T22:01:10.086351-08:00","closed_at":"2025-11-24T22:01:10.086351-08:00"}
{"id":"ef-jsj","title":"efrit-do-async loops on simple questions that don't need tools","description":"When given a simple question like 'What is 2+2?', efrit-do-async enters a loop making 30 API calls before hitting the circuit breaker limit.\n\n**Root cause:** The async executor puts the session into SESSION MODE which tells Claude to use tools and continue multi-step workflows. For questions that don't require Emacs operations (pure conversational/computational questions), Claude should just respond with text and call session_complete.\n\n**Evidence:**\n- Command: 'What is 2 + 2? Just tell me the answer.'\n- Result: 30 API calls, circuit breaker tripped\n- Log shows only API completions, no tool execution details\n\n**Suggested fix:**\n1. Add clear instruction in system prompt: 'For questions that don't require Emacs operations, simply respond with text and use session_complete'\n2. Or: detect trivial questions and don't use session mode at all\n3. Or: require stop_reason='end_turn' (not tool_use) to continue session","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T21:09:02.623141-08:00","updated_at":"2025-11-24T21:57:45.906441-08:00","closed_at":"2025-11-24T21:57:45.906441-08:00"}
{"id":"ef-krh","title":"efrit-do returns nil instead of result for programmatic use","description":"When efrit-do is called programmatically (e.g., from remote queue), it returns nil instead of the result. efrit-do is designed for interactive use with buffer output, not programmatic return values. The remote queue handler tries to capture stdout but efrit-do doesn't print there. Need to either: (1) modify efrit-do to return results, or (2) create a new function efrit-do-programmatic that returns the result.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-25T14:25:41.759866-08:00","updated_at":"2025-11-25T14:38:05.962047-08:00","closed_at":"2025-11-25T14:38:05.962047-08:00"}
{"id":"ef-l2h","title":"Implement file_info tool","description":"Get metadata about files without reading contents.\n\n## Input schema\n- paths: list of file paths to query\n\n## Output (for each file)\n- exists: boolean\n- size: bytes\n- mtime: modification time\n- permissions: file mode\n- is_binary: heuristic detection\n- first_line: for identification (optional)\n- is_directory: boolean\n\n## Use cases\n- Check if file exists before reading\n- Determine file size before deciding to read\n- Batch query multiple files efficiently\n\n## Implementation\nUse file-attributes, file-exists-p, etc. Batch processing for efficiency.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:37:41.3533-08:00","updated_at":"2025-11-25T17:20:23.620751-08:00","closed_at":"2025-11-25T17:20:23.620751-08:00","dependencies":[{"issue_id":"ef-l2h","depends_on_id":"ef-ej7","type":"blocks","created_at":"2025-11-25T16:53:15.633564-08:00","created_by":"daemon"}]}
{"id":"ef-lgk","title":"Phase 4: Implement request_user_input tool for Claude checkpoints","description":"","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-24T23:04:54.437938-08:00","updated_at":"2025-11-25T11:44:32.037007-08:00","closed_at":"2025-11-25T11:44:32.037007-08:00","dependencies":[{"issue_id":"ef-lgk","depends_on_id":"ef-oks","type":"blocks","created_at":"2025-11-24T23:06:04.285985-08:00","created_by":"daemon"}]}
{"id":"ef-m28","title":"Implement vcs_status tool","description":"Understand the current repository state.\n\n## Input schema\n- path: repository path (default: project root)\n\n## Output\n- current_branch: string\n- upstream: tracking branch info (ahead/behind counts)\n- staged_files: list of staged changes\n- unstaged_files: list of modified but unstaged files\n- untracked_files: list of new files\n- stash_count: number of stashed changes\n- recent_commits: last 5 commit summaries\n- is_clean: boolean (nothing to commit)\n- is_rebasing/is_merging: conflict state indicators\n\n## Implementation\nParse output of:\n- git status --porcelain -b\n- git stash list\n- git log --oneline -5\n\n## Error handling\n- Gracefully handle non-git directories\n- Handle detached HEAD state","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:38:24.67177-08:00","updated_at":"2025-11-25T17:21:50.351281-08:00","closed_at":"2025-11-25T17:21:50.351281-08:00"}
{"id":"ef-men","title":"efrit-chat shows buffer objects instead of confirming insertions","description":"When Claude generates code that ends with pop-to-buffer or similar, the result shown is just #\u003cbuffer name\u003e which confuses users into thinking the insertion didn't happen. Need to suppress buffer object results or show better messages.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T00:00:25.194979-08:00","updated_at":"2025-11-24T00:02:34.420195-08:00","closed_at":"2025-11-24T00:02:34.420195-08:00"}
{"id":"ef-n0f","title":"Epic: Project-Wide Awareness - Phase 1 (Visibility Tools)","description":"Foundation for transforming Efrit from buffer-manipulator to project-aware assistant.\n\n## Goal\nAdd tools that give Claude visibility into the entire project structure and content, not just open buffers.\n\n## Tools in this phase\n- project_files: File tree traversal\n- search_content: Grep-like content search\n- read_file: Read arbitrary files (not just buffers)\n- file_info: File metadata without full read\n\n## Success criteria\n- Claude can answer 'what files are in this project?'\n- Claude can find code patterns across the codebase\n- Claude can read files it hasn't opened in a buffer\n\n## Architecture principle\nThese are pure context-gathering tools. No decision logic. Claude interprets results.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-25T16:37:05.983801-08:00","updated_at":"2025-11-25T17:20:25.002299-08:00","closed_at":"2025-11-25T17:20:25.002299-08:00","dependencies":[{"issue_id":"ef-n0f","depends_on_id":"ef-5nx","type":"blocks","created_at":"2025-11-25T16:37:53.222292-08:00","created_by":"daemon"},{"issue_id":"ef-n0f","depends_on_id":"ef-07c","type":"blocks","created_at":"2025-11-25T16:37:53.286848-08:00","created_by":"daemon"},{"issue_id":"ef-n0f","depends_on_id":"ef-aa5","type":"blocks","created_at":"2025-11-25T16:37:53.350455-08:00","created_by":"daemon"},{"issue_id":"ef-n0f","depends_on_id":"ef-l2h","type":"blocks","created_at":"2025-11-25T16:37:53.41517-08:00","created_by":"daemon"},{"issue_id":"ef-n0f","depends_on_id":"ef-w3s","type":"blocks","created_at":"2025-11-25T16:41:03.284002-08:00","created_by":"daemon"}]}
{"id":"ef-n3f","title":"Testing: Tier 10 - Claude Code integration tests","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-24T23:05:13.194174-08:00","updated_at":"2025-11-25T11:59:05.455994-08:00","closed_at":"2025-11-25T11:59:05.455994-08:00","dependencies":[{"issue_id":"ef-n3f","depends_on_id":"ef-gth","type":"blocks","created_at":"2025-11-24T23:06:13.797952-08:00","created_by":"daemon"},{"issue_id":"ef-n3f","depends_on_id":"ef-0xz","type":"blocks","created_at":"2025-11-24T23:06:13.863495-08:00","created_by":"daemon"}]}
{"id":"ef-nqk","title":"Epic: Project-Wide Awareness - Phase 3 (Workflow Enhancement)","description":"Better collaboration between Claude and user on complex/risky operations.\n\n## Goal\nImprove how Claude interacts with user for confirmation, previews, and safety.\n\n## Tools in this phase\n- confirm_action: Explicit confirmation with severity levels\n- show_diff_preview: Preview proposed changes before applying\n- checkpoint: Create restore points before risky operations\n\n## Success criteria\n- User sees clear diff before Claude makes changes\n- Destructive operations require explicit confirmation\n- User can rollback if something goes wrong\n\n## Dependencies\n- Benefits from Phase 1 (read_file for showing current state)\n- Benefits from Phase 2 (vcs_diff for showing changes)\n\n## Architecture principle\nThese tools facilitate human-in-the-loop without adding decision logic to Efrit. Claude decides WHEN to ask, tool just provides the mechanism.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-25T16:38:46.655906-08:00","updated_at":"2025-11-25T18:55:04.243595-08:00","closed_at":"2025-11-25T18:55:04.243595-08:00","dependencies":[{"issue_id":"ef-nqk","depends_on_id":"ef-wv9","type":"blocks","created_at":"2025-11-25T16:39:18.431543-08:00","created_by":"daemon"},{"issue_id":"ef-nqk","depends_on_id":"ef-690","type":"blocks","created_at":"2025-11-25T16:39:18.498509-08:00","created_by":"daemon"},{"issue_id":"ef-nqk","depends_on_id":"ef-hks","type":"blocks","created_at":"2025-11-25T16:39:18.563116-08:00","created_by":"daemon"},{"issue_id":"ef-nqk","depends_on_id":"ef-n0f","type":"blocks","created_at":"2025-11-25T16:39:20.0842-08:00","created_by":"daemon"},{"issue_id":"ef-nqk","depends_on_id":"ef-e6t","type":"blocks","created_at":"2025-11-25T16:52:48.47595-08:00","created_by":"daemon"}]}
{"id":"ef-nx1","title":"Tier 2: Error recovery tests","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-24T22:51:20.457171-08:00","updated_at":"2025-11-24T23:34:42.256619-08:00","closed_at":"2025-11-24T23:34:42.256619-08:00","dependencies":[{"issue_id":"ef-nx1","depends_on_id":"ef-6sv","type":"blocks","created_at":"2025-11-24T22:51:42.512142-08:00","created_by":"daemon"}]}
{"id":"ef-oat","title":"Phase 2: Create M-x efrit-watch-session live inspector","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:04:35.681333-08:00","updated_at":"2025-11-25T11:40:10.748788-08:00","closed_at":"2025-11-25T11:40:10.748788-08:00","dependencies":[{"issue_id":"ef-oat","depends_on_id":"ef-0ag","type":"blocks","created_at":"2025-11-24T23:06:00.363181-08:00","created_by":"daemon"}]}
{"id":"ef-odk","title":"Implement fetch_url tool","description":"Retrieve content from specific URLs.\n\n## Input schema\n- url: page to fetch\n- selector: optional CSS selector to extract specific content\n- format: 'text' | 'markdown' | 'html' (default: markdown)\n- max_length: truncate if longer (default: 50000 chars)\n\n## Output\n- content: the page content in requested format\n- title: page title\n- url: final URL (after redirects)\n- content_type: MIME type\n- truncated: whether content was truncated\n- fetch_time: how long it took\n\n## Implementation\n- Use url-retrieve for fetching\n- Use shr or eww for HTML-to-text conversion\n- For markdown: use pandoc if available, else simple conversion\n\n## Security model\nThree levels (configurable):\n1. Allowlist only: only fetch from approved domains\n2. Confirm each: ask user before each fetch\n3. Open: fetch any URL (not recommended)\n\nDefault: allowlist with common documentation sites:\n- gnu.org, emacs.org\n- stackoverflow.com, stackexchange.com\n- github.com, gitlab.com\n- docs.python.org, developer.mozilla.org\n- etc.\n\n## Use cases\n- Fetch specific documentation page Claude found via web_search\n- Read README from a GitHub repo\n- Access API documentation","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:39:56.082474-08:00","updated_at":"2025-11-25T18:59:05.453386-08:00","closed_at":"2025-11-25T18:59:05.453386-08:00","dependencies":[{"issue_id":"ef-odk","depends_on_id":"ef-gyd","type":"blocks","created_at":"2025-11-25T16:40:04.242271-08:00","created_by":"daemon"},{"issue_id":"ef-odk","depends_on_id":"ef-9hc","type":"blocks","created_at":"2025-11-25T16:40:46.8995-08:00","created_by":"daemon"}]}
{"id":"ef-oks","title":"Phase 4: Conversational Protocol - Add conversation history to session struct","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-24T23:04:53.080646-08:00","updated_at":"2025-11-25T11:41:49.808785-08:00","closed_at":"2025-11-25T11:41:49.808785-08:00","dependencies":[{"issue_id":"ef-oks","depends_on_id":"ef-bxc","type":"blocks","created_at":"2025-11-24T23:06:04.218414-08:00","created_by":"daemon"}]}
{"id":"ef-qat","title":"Claude gets stuck retrying same failing code pattern instead of adapting","description":"When Claude generates code that fails (e.g. incorrect garbage-collect usage), it keeps retrying essentially the same code pattern 10+ times instead of adapting its approach. Test showed 11 continuations all failing with 'Wrong type argument: number-or-marker-p, (conses 16 41947 7656)' - Claude never learned that garbage-collect returns a different structure. System prompt should instruct Claude to: 1) Analyze error messages, 2) Try fundamentally different approaches, 3) Read documentation via eval_sexp with describe-function before retrying.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T12:45:24.414744-08:00","updated_at":"2025-11-24T20:17:53.369998-08:00","closed_at":"2025-11-24T20:17:53.369998-08:00"}
{"id":"ef-r0k","title":"efrit-do tool calls not logged to session work_log","description":"During dogfood testing, tool calls made by efrit-do are not recorded in work_log.jsonl. This is because efrit-do.el doesn't use efrit-executor or efrit-session-add-work.\n\nEvidence:\n- Sent command to analyze codebase\n- Claude called glob_files (returned error)\n- Session created: efrit-20251125-210918-c495\n- progress.jsonl has session-start and session-end\n- work_log.jsonl does not exist / is empty\n\nRequired:\n- efrit-do should call efrit-session-add-work after each tool call\n- This is needed for budget tracking, history compression, and debugging","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-25T21:11:17.496706-08:00","updated_at":"2025-11-25T21:11:17.496706-08:00"}
{"id":"ef-rk0","title":"Fix tool use protocol in efrit-chat (both modes)","description":"efrit-chat has broken tool use protocol causing 'pushing a rope' behavior where tools execute but Claude never gets confirmation. Affects both classic and streamlined modes. Requires: 1) Capturing tool_use_id, 2) Building proper tool_result messages, 3) Sending results back to Claude before showing user response. See child issues ef-ajc, ef-7w9, ef-af8","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-24T00:33:55.9353-08:00","updated_at":"2025-11-24T20:16:05.635651-08:00","closed_at":"2025-11-24T20:16:05.635651-08:00","dependencies":[{"issue_id":"ef-rk0","depends_on_id":"ef-fub","type":"blocks","created_at":"2025-11-24T00:38:52.445183-08:00","created_by":"daemon"},{"issue_id":"ef-rk0","depends_on_id":"ef-al6","type":"blocks","created_at":"2025-11-24T00:38:52.512291-08:00","created_by":"daemon"},{"issue_id":"ef-rk0","depends_on_id":"ef-5af","type":"blocks","created_at":"2025-11-24T00:38:52.58645-08:00","created_by":"daemon"},{"issue_id":"ef-rk0","depends_on_id":"ef-3go","type":"blocks","created_at":"2025-11-24T00:38:52.65899-08:00","created_by":"daemon"},{"issue_id":"ef-rk0","depends_on_id":"ef-8to","type":"blocks","created_at":"2025-11-24T00:38:52.72644-08:00","created_by":"daemon"},{"issue_id":"ef-rk0","depends_on_id":"ef-beu","type":"blocks","created_at":"2025-11-24T00:38:52.796606-08:00","created_by":"daemon"}]}
{"id":"ef-rqu","title":"Implement vcs_log tool","description":"Understand commit history.\n\n## Input schema\n- path: file or directory for filtered history (optional)\n- count: number of commits (default: 10)\n- since: date filter (optional, e.g., '1 week ago')\n- author: author filter (optional)\n- grep: commit message search (optional)\n\n## Output\n- commits: list of:\n  - hash: short hash\n  - full_hash: full SHA\n  - author: name and email\n  - date: ISO format\n  - message: commit message (first line + body)\n  - files_changed: count (optional, can be slow)\n\n## Implementation\nParse git log with format string:\ngit log --format='%H|%h|%an|%ae|%aI|%s' -n \u003ccount\u003e\n\n## Use cases\n- Understand recent changes\n- Find when a bug was introduced\n- See who worked on a file","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:38:27.511678-08:00","updated_at":"2025-11-25T17:24:05.660889-08:00","closed_at":"2025-11-25T17:24:05.660889-08:00"}
{"id":"ef-sha","title":"Phase 1: Hook progress emission into efrit-executor tool execution","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-24T23:04:22.576279-08:00","updated_at":"2025-11-24T23:16:17.324955-08:00","closed_at":"2025-11-24T23:16:17.324955-08:00","dependencies":[{"issue_id":"ef-sha","depends_on_id":"ef-6wy","type":"blocks","created_at":"2025-11-24T23:05:58.594775-08:00","created_by":"daemon"}]}
{"id":"ef-slc","title":"Phase 3: Create efrit-inject.sh helper script for Claude Code","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-24T23:04:46.251807-08:00","updated_at":"2025-11-25T11:36:17.919672-08:00","closed_at":"2025-11-25T11:36:17.919672-08:00","dependencies":[{"issue_id":"ef-slc","depends_on_id":"ef-bxc","type":"blocks","created_at":"2025-11-24T23:06:02.254249-08:00","created_by":"daemon"}]}
{"id":"ef-syq","title":"Claude doesn't call session_complete after successful execution","description":"**Critical behavior issue:** After successfully executing a task (e.g., defining a function and calling it), Claude does NOT call session_complete. Instead, it keeps re-calling the same tool with identical input until the circuit breaker trips.\n\n**Evidence:**\nCommand: 'Define a function called efrit-test-greet that takes a name parameter and displays a message greeting that person, then call it with my name Steve'\n\n- eval_sexp executed successfully: 'Hello, Steve! Nice to meet you!'\n- Function was properly defined (fboundp returns t)\n- But Claude called eval_sexp 6 times with the SAME input\n- Circuit breaker eventually blocked it at call #4\n- Session never completed normally\n\n**Root cause hypothesis:**\n1. Claude doesn't recognize when the task is complete\n2. The system prompt SESSION MODE instructions don't clearly say 'call session_complete when your task succeeds'\n3. Claude may be trying to 'verify' the result but keeps re-executing instead\n\n**Impact:** \n- Every successful command burns 4-6x more tokens than needed\n- User experience is poor (long waits for simple tasks)\n- Circuit breaker masks the problem but doesn't solve it\n\n**Fix needed:**\nAdd explicit instruction: 'When you execute code and get a successful result, IMMEDIATELY call session_complete with a summary of what you accomplished. Do NOT re-execute the same code.'","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-24T21:14:03.996904-08:00","updated_at":"2025-11-24T21:56:51.14178-08:00","closed_at":"2025-11-24T21:56:51.14178-08:00"}
{"id":"ef-tep","title":"No mechanism to detect and break error loops in multi-step sessions","description":"When Claude gets stuck in an error loop (generating same failing code repeatedly), there's no detection mechanism beyond the circuit breaker. The circuit breaker only counts consecutive same-tool calls, not whether the tool is producing the same error. Feature needed: 1) Track error signatures (hash of error message), 2) If same error occurs 3+ times, inject system message about trying different approach, 3) Consider auto-completing session with error summary after N failed attempts.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-24T12:45:26.578958-08:00","updated_at":"2025-11-24T20:37:42.308308-08:00","closed_at":"2025-11-24T20:37:42.308308-08:00"}
{"id":"ef-tii","title":"Phase 2: Add status query endpoint to remote queue","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-24T23:04:34.34817-08:00","updated_at":"2025-11-25T09:41:47.026989-08:00","closed_at":"2025-11-25T09:41:47.026989-08:00","dependencies":[{"issue_id":"ef-tii","depends_on_id":"ef-0ji","type":"blocks","created_at":"2025-11-24T23:06:00.303913-08:00","created_by":"daemon"}]}
{"id":"ef-upy","title":"efrit-chat intermittent failures - first works, second iffy, third fails","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-23T23:47:34.868074-08:00","updated_at":"2025-11-23T23:49:38.172762-08:00","closed_at":"2025-11-23T23:49:38.172762-08:00"}
{"id":"ef-w3s","title":"Design: Context budget management for expanded tool set","description":"With more tools gathering more context, we need smarter context management.\n\n## Design Complete ✓\n\nSee: docs/design/context-budget-management.md\n\n## Key Design Decisions\n\n### 1. Token Estimation (not counting)\n- Use character-based estimation (~3.5 chars/token)\n- Accurate enough for budgeting (within 20%)\n- Avoids tokenizer dependency\n\n### 2. Budget Tiers\n- System Prompt: 8k tokens\n- Work History: 12k tokens (compressed)\n- Tool Results: 40k tokens (current call)\n- User Message: 10k tokens\n- Response Buffer: 30k tokens\n- **Total Target: 100k** (safe margin below 200k limit)\n\n### 3. Two-Phase Result Delivery\n- **Immediate**: Full result for Claude's use\n- **Historical**: Compressed to ~500 chars for work log\n\n### 4. Tool-Specific Compression\nEach tool has custom compression for history:\n- project_files: \"500 files, types: .el (234), .md (45)...\"\n- search_content: \"50 matches in 12 files: file1.el (5)...\"\n- read_file: \"Read file.el (1234 lines). Key sections...\"\n- vcs_diff: \"5 files, +234/-89 lines. Modified: ...\"\n\n### 5. Dynamic Budget Hints\nTool schemas update with remaining budget:\n- \"Current budget allows ~200 files\"\n- \"[Budget Alert: ~20k tokens remaining]\"\n\n### 6. Pure Executor Compliance\n- Efrit: counts, truncates, reports (mechanical)\n- Claude: decides what's important, what to summarize, when to stop\n\n## Implementation Phases\n\n1. **Budget Tracking**: New efrit-budget.el with core structs\n2. **Tool Updates**: Each tool respects budget parameter\n3. **Session Integration**: Budget tracking in efrit-session.el\n4. **Dynamic Schemas**: Budget hints in tool descriptions\n\n## Next Steps\n\nCreate implementation issues from this design.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T16:40:34.079683-08:00","updated_at":"2025-11-25T19:19:17.413849-08:00","closed_at":"2025-11-25T19:19:17.413849-08:00"}
{"id":"ef-wpu","title":"Bug: efrit-chat eval-sexp tool failing with void-variable error","description":"ROOT CAUSE CONFIRMED + DEEPER ISSUE:\n\nPROBLEM 1: System prompt doesn't tell Claude to verify state first\nPROBLEM 2: No dedicated 'read buffer' tool exists\n\nHOW CLAUDE CAN READ BUFFERS:\n✓ Call eval_sexp with (buffer-string) to get full contents\n✓ Call eval_sexp with (buffer-substring START END) for regions\n✓ Call get_context to get 200 chars before/after point\n\nWHAT'S MISSING FROM SYSTEM PROMPT:\nThe prompt (lines 619-675) shows examples of buffer MANIPULATION:\n  - (insert \"text\")\n  - (goto-char (point-max))\n  - (search-forward \"target\")\n\nBut NEVER shows how to READ buffer state first:\n  - (buffer-string) to see contents\n  - (with-current-buffer \"*scratch*\" (buffer-string))\n  - (save-excursion (goto-char (point-min)) (buffer-substring ...))\n\nTHE FIX NEEDS TWO PARTS:\n\n1. Add 'Verification Before Action' section:\n   'BEFORE manipulating buffers, ALWAYS verify state by reading contents first'\n\n2. Add 'Reading Buffer Contents' examples:\n   - Read current buffer: (buffer-string)\n   - Read specific buffer: (with-current-buffer \"name\" (buffer-string))\n   - Read region: (buffer-substring START END)\n   - Find last sexp: (save-excursion (goto-char (point-max)) (backward-sexp) (point))\n\nEXAMPLE in prompt should show:\n'To eval last form in *scratch*:\n1. Read buffer: (with-current-buffer \"*scratch*\" (buffer-string))\n2. Locate target form position in that string\n3. Generate code to move to that position and eval'\n\nThis is both a PROMPT ENGINEERING and EDUCATION problem.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-24T01:37:25.544986-08:00","updated_at":"2025-11-24T11:24:12.53598-08:00","closed_at":"2025-11-24T11:24:12.53598-08:00"}
{"id":"ef-wv9","title":"Implement confirm_action tool","description":"Explicit user confirmation for destructive operations.\n\n## Input schema\n- action: short description of what will happen (required)\n- details: list of specific items (files affected, etc.)\n- severity: 'info' | 'warning' | 'danger' (default: 'warning')\n- options: custom choices (default: ['Yes', 'No'])\n- timeout_seconds: how long to wait (default: 300 = 5 min)\n\n## Output\n```json\n{\n  \"success\": true,\n  \"result\": {\n    \"confirmed\": true,\n    \"choice\": \"Yes\",\n    \"comment\": \"optional user comment\",\n    \"response_time_seconds\": 5.2\n  }\n}\n```\n\nOr if rejected/timeout:\n```json\n{\n  \"success\": true,\n  \"result\": {\n    \"confirmed\": false,\n    \"choice\": \"No\",\n    \"reason\": \"user_rejected\" | \"timeout\"\n  }\n}\n```\n\n## Session behavior\n- Session PAUSES while waiting for user response (like request_user_input)\n- On confirmation: session continues, Claude sees result\n- On rejection: Claude should handle gracefully (not error)\n- On timeout: treated as rejection\n\n## UI presentation\n- info: standard y-or-n-p style prompt\n- warning: yellow highlighting, shows details list\n- danger: red highlighting, requires typing 'yes' or confirmation phrase\n\n### Danger mode\nFor danger severity, don't accept single keypress:\n```\n⚠️  DANGER: This will delete 15 files permanently.\n\nFiles to delete:\n  - src/old-module.el\n  - src/deprecated.el\n  [... 13 more ...]\n\nType 'yes' to confirm: _\n```\n\n## Audit trail\nLog all confirmations to efrit session log:\n- timestamp\n- action requested\n- severity\n- user choice\n- response time\n\n## Difference from request_user_input\n- Structured for confirmation workflow (not open questions)\n- Severity levels with visual treatment\n- Built-in audit logging\n- Timeout handling\n\n## Use cases\n- 'This will delete 15 files. Proceed?' (danger)\n- 'This will modify production config. Are you sure?' (danger)\n- 'Bulk rename 50 files. Confirm?' (warning)\n- 'Create new directory src/utils/. Ok?' (info)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-25T16:39:08.009074-08:00","updated_at":"2025-11-25T18:26:07.758608-08:00","closed_at":"2025-11-25T18:26:07.758608-08:00"}
{"id":"ef-ytl","title":"Tier 6: Stress tests and edge cases","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-24T22:51:26.942707-08:00","updated_at":"2025-11-25T01:19:33.403134-08:00","closed_at":"2025-11-25T01:19:33.403134-08:00","dependencies":[{"issue_id":"ef-ytl","depends_on_id":"ef-6sv","type":"blocks","created_at":"2025-11-24T22:51:42.753763-08:00","created_by":"daemon"}]}
{"id":"ef-z9w","title":"No project root awareness for daemon-mode efrit","description":"During dogfood testing with daemon-mode efrit, Claude doesn't know the project location.\n\nEvidence:\n- Command: 'Analyze efrit codebase, list .el files in lisp/'\n- Claude called glob_files with pattern='lisp/' \n- This expanded to ~/lisp/ (doesn't exist)\n- Actual project is at ~/src/efrit/lisp/\n\nThe daemon starts with default-directory=~/ and has no project context.\n\nOptions to consider:\n1. Include project_root in request options\n2. Add set_project_root tool\n3. Add project_root to context returned by efrit-tools-get-context\n4. Check for .efrit.json or similar marker in ancestor directories\n\nThis is critical for any agentic work - Claude needs to know where to look for files.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-25T21:11:18.912738-08:00","updated_at":"2025-11-25T21:11:18.912738-08:00"}
