{"id":"ef-3i7","title":"Update system prompt with TodoWrite guidance","description":"Update efrit-do--command-system-prompt and efrit-do--session-protocol-instructions to guide Claude on using todo_write.\n\n## Changes\n\nReplace all references to the 8 old tools with todo_write guidance:\n- Remove: todo_analyze, todo_add, todo_update, todo_status, todo_next, todo_execute_next, todo_get_instructions, todo_complete_check\n- Add: todo_write with clear when-to-use guidance\n\n## Guidance Pattern (from Claude Code)\n\n```\nUse todo_write when:\n- Complex multi-step tasks (3+ steps)\n- User provides multiple tasks\n- Breaking down large features\n\nDo NOT use for:\n- Simple single-action tasks\n- Trivial operations\n- Pure information queries\n```\n\n## Key changes\n\n1. efrit-do--session-protocol-instructions: simplify dramatically\n2. Remove all anti-loop messaging (no longer needed)\n3. Remove workflow state references\n\n## Acceptance\n\n- [ ] System prompt references todo_write not old tools\n- [ ] Clear when-to-use / when-not-to-use guidance\n- [ ] No anti-loop warnings in prompt","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T22:22:06.093655-08:00","updated_at":"2025-11-26T22:38:47.687923-08:00","closed_at":"2025-11-26T22:38:47.687923-08:00","dependencies":[{"issue_id":"ef-3i7","depends_on_id":"ef-v2y","type":"blocks","created_at":"2025-11-26T22:23:07.933483-08:00","created_by":"daemon"}]}
{"id":"ef-9jp","title":"Circuit breaker trips but session keeps calling tools","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-26T20:53:25.214389-08:00","updated_at":"2025-11-26T22:59:30.650305-08:00","closed_at":"2025-11-26T22:59:30.650305-08:00"}
{"id":"ef-a46","title":"session_complete message overwrites tool execution results","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-26T20:53:25.260994-08:00","updated_at":"2025-11-26T22:53:12.565291-08:00","closed_at":"2025-11-26T22:53:12.565291-08:00"}
{"id":"ef-a4w","title":"Add mode line current-task indicator","description":"Show the current in-progress task in the Emacs mode line.\n\n## Display\n\nWhen a task is in_progress, show in mode line:\n```\n[Efrit: Implementing auth module]\n```\n\nWhen no tasks or all complete:\n```\n[Efrit: idle]\n```\n\n## Implementation\n\n1. Add mode-line-format element\n2. Update when todo_write sets a task to in_progress\n3. Truncate long task names (max ~40 chars)\n4. Make it optional (defcustom efrit-show-task-in-modeline)\n\n## Acceptance\n\n- [ ] Mode line shows current task\n- [ ] Updates live when todo_write called\n- [ ] Configurable on/off","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T22:22:09.457512-08:00","updated_at":"2025-11-26T23:25:39.365794-08:00","closed_at":"2025-11-26T23:25:39.365794-08:00","dependencies":[{"issue_id":"ef-a4w","depends_on_id":"ef-v2y","type":"blocks","created_at":"2025-11-26T22:23:08.060287-08:00","created_by":"daemon"}]}
{"id":"ef-dc8","title":"Design TodoWrite-style interface for better task tracking","description":"Replace the current 8-tool TODO system with a single TodoWrite-style tool.\n\n## Why\n\nThe current system has:\n- 8 separate tools (todo_add, todo_update, todo_analyze, etc.)\n- Complex anti-loop infrastructure (workflow state machine, tool call counting, schema filtering)\n- Client-side intelligence in todo_analyze (pattern matching on commands)\n- Sync issues from incremental state updates\n\nThe TodoWrite pattern (used by Claude Code) solves these:\n- Single tool, full state replacement each call\n- No sync issues, no loops by design\n- Pure Executor: Efrit just stores what Claude sends\n- Proven pattern Claude already knows\n\n## Scope\n\n- Implement todo_write tool\n- Update system prompt guidance  \n- UI: *efrit-todos* buffer + mode line\n- Delete old tools + anti-loop machinery\n- Update docs\n\n## Out of Scope (separate issues)\n\n- ef-t7f: Response detail lost\n- ef-9jp: Circuit breaker doesn't terminate session\n- ef-a46: session_complete overwrites results","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2025-11-26T20:53:25.30635-08:00","updated_at":"2025-11-26T22:21:24.524997-08:00"}
{"id":"ef-kyl","title":"Create *efrit-todos* buffer with live display","description":"Create a dedicated buffer showing current TODO state with visual indicators.\n\n## Buffer: *efrit-todos*\n\nDisplay format:\n```\nEfrit Tasks\n===========\n\n→ [IN PROGRESS] Implementing auth module\n  [PENDING] Add unit tests  \n  [PENDING] Update documentation\n✓ [COMPLETED] Read existing code\n```\n\n## Implementation\n\n1. Create efrit-todos-mode (read-only, special mode)\n2. Function to render current TODO list\n3. Auto-update when todo_write is called\n4. Color coding: pending=default, in_progress=highlight, completed=dim\n\n## Optional enhancements\n\n- Click to expand task details\n- Timestamp display\n- Progress bar (X of Y complete)\n\n## Acceptance\n\n- [ ] Buffer exists and displays TODO list\n- [ ] Auto-updates on todo_write calls\n- [ ] Visual distinction between states","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T22:22:07.535516-08:00","updated_at":"2025-11-26T23:17:20.978036-08:00","closed_at":"2025-11-26T23:17:20.978036-08:00","dependencies":[{"issue_id":"ef-kyl","depends_on_id":"ef-v2y","type":"blocks","created_at":"2025-11-26T22:23:07.996262-08:00","created_by":"daemon"}]}
{"id":"ef-t7f","title":"Response detail is lost - only shows 'Command executed successfully'","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-26T20:53:25.113444-08:00","updated_at":"2025-11-26T22:48:03.77131-08:00","closed_at":"2025-11-26T22:48:03.77131-08:00"}
{"id":"ef-utf","title":"TODO system not used unless explicitly requested","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-26T20:53:25.163985-08:00","updated_at":"2025-11-26T23:14:23.899893-08:00","closed_at":"2025-11-26T23:14:23.899893-08:00"}
{"id":"ef-v2y","title":"Implement todo_write tool (schema + handler + state)","description":"Core implementation of the TodoWrite-style tool.\n\n## Schema\n```json\n{\n  \"name\": \"todo_write\",\n  \"parameters\": {\n    \"todos\": [{\n      \"content\": \"Task in imperative form\",\n      \"status\": \"pending|in_progress|completed\",\n      \"activeForm\": \"Task in present continuous\"\n    }]\n  }\n}\n```\n\n## Implementation\n\n1. Add schema to efrit-do--tools-schema\n2. Add handler to efrit-do--tool-handlers  \n3. Handler stores list in buffer-local or global var\n4. Return success with current state summary\n\n## Key principle\n\nPure Executor: just store what Claude sends. No validation of task content, no state machine, no \"smart\" behavior.\n\n## Acceptance\n\n- [ ] Schema defined and tool appears in API\n- [ ] Handler stores TODO list\n- [ ] Calling todo_write replaces entire list (not incremental)\n- [ ] Returns confirmation with count","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T22:21:42.847276-08:00","updated_at":"2025-11-26T22:30:50.599828-08:00","closed_at":"2025-11-26T22:30:50.599828-08:00"}
{"id":"ef-w5f","title":"Remove old TODO tools and anti-loop machinery","description":"Delete the 8 old TODO tools and all associated anti-loop infrastructure.\n\n## Tools to remove\n\nFrom efrit-do--tool-handlers:\n- todo_add\n- todo_update\n- todo_show\n- todo_analyze\n- todo_status\n- todo_next\n- todo_execute_next\n- todo_get_instructions\n- todo_complete_check\n\n## Handlers to delete\n\n- efrit-do--handle-todo-add\n- efrit-do--handle-todo-update\n- efrit-do--handle-todo-show\n- efrit-do--handle-todo-analyze\n- efrit-do--handle-todo-status\n- efrit-do--handle-todo-next\n- efrit-do--handle-todo-execute-next\n- efrit-do--handle-todo-complete-check\n\n## Anti-loop infrastructure to remove\n\n- efrit-do--workflow-state variable\n- efrit-do--tool-call-count variable\n- efrit-do--last-tool-called variable\n- efrit-do--get-current-tools-schema filtering logic (lines 906-952)\n- All LOOP PREVENTION messages embedded in responses\n\n## Keep\n\n- format_todo_list (may still be useful)\n- Basic TODO state storage (used by new todo_write)\n\n## Acceptance\n\n- [ ] Old tool schemas removed from API\n- [ ] Old handlers deleted\n- [ ] Anti-loop state machine removed\n- [ ] Code compiles clean\n- [ ] No references to old tools remain","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T22:22:28.64919-08:00","updated_at":"2025-11-26T23:07:20.718329-08:00","closed_at":"2025-11-26T23:07:20.718329-08:00","dependencies":[{"issue_id":"ef-w5f","depends_on_id":"ef-v2y","type":"blocks","created_at":"2025-11-26T22:23:08.128144-08:00","created_by":"daemon"}]}
{"id":"ef-z80","title":"Update documentation for TodoWrite system","description":"Update all documentation to reflect the new todo_write tool.\n\n## Files to update\n\n- docs/design-todo-system.md - mark as implemented, update with final design\n- CLAUDE.md - update any TODO tool references\n- README.md - if it mentions TODO features\n\n## Changes\n\n- Remove references to 8-tool system\n- Document todo_write schema and usage\n- Update examples to show new pattern\n- Archive or remove obsolete design discussion\n\n## Acceptance\n\n- [ ] No docs reference old TODO tools\n- [ ] todo_write documented with examples\n- [ ] Design doc updated to reflect implementation","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-26T22:22:29.974291-08:00","updated_at":"2025-11-26T22:22:29.974291-08:00","dependencies":[{"issue_id":"ef-z80","depends_on_id":"ef-w5f","type":"blocks","created_at":"2025-11-26T22:23:08.196143-08:00","created_by":"daemon"}]}
